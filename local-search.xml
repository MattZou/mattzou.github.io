<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>遥感云平台</title>
    <link href="/2021/04/20/%E9%81%A5%E6%84%9F%E4%BA%91%E5%B9%B3%E5%8F%B0/"/>
    <url>/2021/04/20/%E9%81%A5%E6%84%9F%E4%BA%91%E5%B9%B3%E5%8F%B0/</url>
    
    <content type="html"><![CDATA[<p>在Google成功推广GEE之后，微软也推出了<strong>Planetary Computer</strong>（所以真是做PC系统起家的🤡），两大巨头都瞄准了空间云计算服务（微软估计是盖茨建议的😏<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="How to Avoid a Climate Disaster">[1]</span></a></sup>）这块市场，基于自身强大的云存储能力，为全球环境数据找了个好的去处，同时也能让大家白嫖<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="微软官方商城">[2]</span></a></sup>一下算力（毕竟显卡那么贵了💴💴）===</p><p>这是个导航，会持续更新这两个产品的使用笔记及感悟。</p><h2 id="Google-Earth-Engine"><a href="#Google-Earth-Engine" class="headerlink" title="Google Earth Engine"></a>Google Earth Engine</h2><blockquote><ol><li> <a href="%5Ba%5D(https://mattzou.com/2019/11/30/GEE%E7%AC%94%E8%AE%B0/)">入门笔记</a> <strong>GEE</strong> 基础笔记</li><li> <a href="%5Bb%5D(https://mattzou.com/2019/11/30/GEE%E7%AC%94%E8%AE%B0_%E4%BA%A7%E5%93%81%E6%98%BE%E7%A4%BA/)">产品显示</a> <strong>GEE</strong> <code>code editor</code> 应用</li></ol></blockquote><h2 id="Planetary-Computer"><a href="#Planetary-Computer" class="headerlink" title="Planetary Computer"></a>Planetary Computer</h2><p>邀请测试阶段，<a href="https://planetarycomputer.microsoft.com/">申请地址</a></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.gatesnotes.com/Energy/My-new-climate-book-is-finally-here">How to Avoid a Climate Disaster</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://www.microsoftstore.com.cn/">微软官方商城</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>目录</category>
      
    </categories>
    
    
    <tags>
      
      <tag>云服务</tag>
      
      <tag>遥感</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ggplot2 总结</title>
    <link href="/2021/04/15/R-ggplot2/"/>
    <url>/2021/04/15/R-ggplot2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ggplot2使用总结，各种坑和技巧</p></blockquote><span id="more"></span><h2 id="What-is-ggplot2"><a href="#What-is-ggplot2" class="headerlink" title="What is ggplot2"></a>What is ggplot2</h2><p><a href="https://ggplot2.tidyverse.org/index.html"><strong>ggplot2</strong></a>是<a href="https://www.tidyverse.org/">tidyverse</a>家族中进行数据可视化的核心package<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/tidyverse.jpg/pic"></p><h2 id="How-to-use-ggplot2"><a href="#How-to-use-ggplot2" class="headerlink" title="How to use ggplot2"></a>How to use ggplot2</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"tidyverse"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><p>搭配<a href="https://www.rstudio.com/products/rstudio/">RStudio</a>食用更佳。</p><h3 id="功能速览"><a href="#功能速览" class="headerlink" title="功能速览"></a>功能速览</h3><ol><li>Rstudio提供一系列的<a href="https://www.rstudio.com/resources/cheatsheets/">Cheatsheets</a>用于快速入门及核心功能速查，ggplot2部分可<a href="https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf">下载</a>。</li><li>各函数详细参数及示例参见<a href="https://ggplot2.tidyverse.org/reference/index.html">Reference</a>。</li><li>ggplot2还支持<a href="https://exts.ggplot2.tidyverse.org/gallery/">拓展包</a>，针对特殊功能，如<a href="https://gganimate.com/">动态图片</a>、<a href="https://github.com/jrnold/ggthemes">主题设定</a>、<a href="https://github.com/aphalo/ggpmisc/">图表注释</a>、<a href="%5Bggstatsplot%5D(https://github.com/IndrajeetPatil/ggstatsplot)">增强型统计图表</a>等，拓展包提供了更好的封装，简化使用。</li></ol><h3 id="可视化理念"><a href="#可视化理念" class="headerlink" title="可视化理念"></a>可视化理念</h3><ul><li><strong>作者意图</strong><blockquote><p>All plots are composed of the <strong>data</strong>, the information you want to visualise, and a <strong>mapping</strong>, the description of how the data’s variables are mapped to aesthetic attributes.<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="ggplot2: elegant graphics for data analysis">[1]</span></a></sup><br><a href="http://hadley.nz/">Hadley Wickham</a></p></blockquote></li><li><strong>我的理解</strong><br>gg:  <strong>Grammar of Graphics</strong>，ggplot2，把图分为数据，几何图形，图形属性等几个部分，把图的各个部分定义为组件形式，组件实现数据与几何对象的映射，通过图形属性定义组件之间的组合形式进行绘图。</li></ul><h2 id="Tricks-and-Bugs"><a href="#Tricks-and-Bugs" class="headerlink" title="Tricks and Bugs"></a>Tricks and Bugs</h2><h3 id="Framework"><a href="#Framework" class="headerlink" title="Framework"></a>Framework</h3><p>个人习惯按以下核心框架绘图。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">p <span class="token operator">&lt;-</span>  <span class="token comment"># 创建空白ggplot对象</span> ggplot<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token comment"># 添加一个或多个几何对象</span> <span class="token comment"># 个人不太喜欢把data和aes放在ggplot()里全局设置</span> <span class="token comment"># 如果多个几何对象分别使用不同数据源，指定全局设置会造成混乱</span> geom_point<span class="token punctuation">(</span>data <span class="token operator">=</span> <span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token operator">+</span>  <span class="token comment"># 设置坐标轴标题</span> labs<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token operator">+</span>  <span class="token comment"># 设置坐标轴缩放</span> scale_x_continuous<span class="token punctuation">(</span>limits <span class="token operator">=</span> <span class="token punctuation">,</span> breaks <span class="token operator">=</span> <span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token operator">+</span>  <span class="token comment"># 添加标注</span> annotate<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token operator">+</span>  <span class="token comment"># 设置主题样式</span> theme_bw<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token operator">+</span>  <span class="token comment"># 覆写部分主题配置</span> theme<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p>各类图都可以在此模板基础上进行调整与自定义，详细配置建议参考<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="Function Reference">[2]</span></a></sup>。</p><p>以下内容为我在日常使用中调整和配置的tricks。</p><h3 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h3><p>ggplot2 的典型结构如下，<code>panel</code>部分用于承载几何对象，其他每个部分都可单独设置。<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/structure.png/pic"></p><h3 id="Geoms"><a href="#Geoms" class="headerlink" title="Geoms"></a>Geoms</h3><p>各种Geoms的实现方法官方示例十分详细，请<a href="https://ggplot2.tidyverse.org/reference/index.html#section-layers">移步</a></p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 查看设置点的形状</span>ggpubr<span class="token operator">::</span>show_point_shapes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 查看设置线的形状</span>ggpubr<span class="token operator">::</span>show_line_types<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/pointtype.png/pic"></div><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/linetype.jpg/pic"></div></div><div class="group-image-row"></div></div><h3 id="Scales"><a href="#Scales" class="headerlink" title="Scales"></a>Scales</h3><ul><li><p><a href="https://mattzou.com/2019/11/23/ggplot2-Axis/">ggplot2 坐标轴调整</a></p></li><li><p><a href="https://mattzou.com/2020/07/16/ggplot2-Expression/">ggplot2 使用expression添加公式与数学符号</a></p></li><li><p><a href="https://mattzou.com/2019/11/23/ggplot2-Dual-Axis/">ggplot2 双坐标轴实现</a></p></li></ul><h3 id="Themes"><a href="#Themes" class="headerlink" title="Themes"></a>Themes</h3><p>用于调整<code>theme(...)</code>中的内容。</p><ul><li><p>背景色</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 无填充则设置为 element_blank()</span><span class="token comment"># 绘图区</span>panel.background <span class="token operator">=</span> element_rect<span class="token punctuation">(</span>fill<span class="token punctuation">,</span> color<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment"># 绘图区外侧</span>plot.background <span class="token operator">=</span> element_rect<span class="token punctuation">(</span>fill<span class="token punctuation">,</span> color<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li><li><p>网格线</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 主网格</span>panel.grid.major <span class="token operator">=</span> element_line<span class="token punctuation">(</span>colour<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span><span class="token comment"># 次网格</span>panel.grid.minor <span class="token operator">=</span> element_line<span class="token punctuation">(</span>colour<span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></li><li><p>绘图边距<br>查看默认绘图边距<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="r - 默认的ggplot2绘图边距是多少?">[3]</span></a></sup>，其他边距内容参见<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="R语言基础绘图之边距参数">[4]</span></a></sup></p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 默认主题</span>theme_grey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">$</span>plot.margin<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">5.5</span>pt <span class="token number">5.5</span>pt <span class="token number">5.5</span>pt <span class="token number">5.5</span>pt<span class="token comment"># 其他主题（推荐）</span>theme_get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">$</span>plot.margin <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li><li><p><a href="https://mattzou.com//2020/07/14/ggplot2-Legend/">ggplot2 调整图例</a></p></li></ul><h3 id="Color"><a href="#Color" class="headerlink" title="Color"></a>Color</h3><p><a href="https://mattzou.com/2019/04/21/ggplot2-Color/">ggplot2 颜色配置</a></p><h3 id="Font"><a href="#Font" class="headerlink" title="Font"></a>Font</h3><p>绘图使用<code>Times New Roman</code>字体。</p><ol><li>定义字体样式<div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">windowsFonts<span class="token punctuation">(</span>RMN <span class="token operator">=</span> windowsFont<span class="token punctuation">(</span><span class="token string">"Times New Roman"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li><li>在需要设置字体的位置设置<code>family</code>属性<div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">family <span class="token operator">=</span> <span class="token string">"RMN"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li></ol><h3 id="Facetting"><a href="#Facetting" class="headerlink" title="Facetting"></a>Facetting</h3><p><a href="https://mattzou.com/2019/07/03/ggplot2-Facet/">ggplot2 分面绘图</a></p><h3 id="Annotations"><a href="#Annotations" class="headerlink" title="Annotations"></a>Annotations</h3><p><a href="https://mattzou.com/2020/10/21/ggplot2-Annotation/">ggplot2 添加注释</a></p><h3 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h3><p>ggplot2 多图组合主要通过<code>grid</code>等一系列包实现<sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" aria-label="Laying out multiple plots on a page">[5]</span></a></sup>。<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/gridExtra.png/pic"><br>规则排列</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 并排多图，nrow指定图像排列行数</span>p <span class="token operator">+</span> grid.arrange<span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment"># 多图不规则排列，将需要排列的图像加入列表 gl，通过layout_matrix指定排列形式</span>p <span class="token operator">+</span> grid.arrange<span class="token punctuation">(</span>  grobs <span class="token operator">=</span> gl<span class="token punctuation">,</span>  widths <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  layout_matrix <span class="token operator">=</span> rbind<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        c<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/ggplot2-mixing-multiple-plots-common-legend-data-visualization-1.png/pic"></div><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/layout_matrix.png/pic"></div></div><div class="group-image-row"></div></div><p>对于重叠图可以使用<code>annotation_custom</code>，指定子图排布位置。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># g 是子图元素</span>p <span class="token operator">+</span> annotation_custom<span class="token punctuation">(</span>    grob <span class="token operator">=</span> g<span class="token punctuation">,</span>    <span class="token comment"># 定位坐标，左下右上点</span>    xmin <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>    xmax <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>    ymin <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span>    ymax <span class="token operator">=</span> <span class="token number">10</span>  <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>图像输出直接使用<code>ggsave()</code><sup id="fnref:6" class="footnote-ref"><a href="#fn:6" rel="footnote"><span class="hint--top hint--rounded" aria-label="Save a ggplot (or other grid object) with sensible defaults">[6]</span></a></sup></p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">ggsave<span class="token punctuation">(</span>  <span class="token comment"># 图像名称</span>  filename<span class="token punctuation">,</span>  <span class="token comment"># 图对象</span>  plot<span class="token punctuation">,</span>  width <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">,</span>  height <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">,</span>  units <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"in"</span><span class="token punctuation">,</span> <span class="token string">"cm"</span><span class="token punctuation">,</span> <span class="token string">"mm"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 分辨率</span>  dpi <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">,</span>  <span class="token comment"># 对于tiff类型图像，建议加入此选项压缩图片</span>  compression <span class="token operator">=</span> <span class="token string">"lzw"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p>Elsevier推荐出图尺寸，可以据此调整<code>width</code><br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/Elsevier.png/pic"></p><h2 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h2><ul><li><p>ggplot2 提供了强大的自定义功能，可以通过长期使用形成适应自己研究体系的绘图模板，方便绘图的标准化，未来使用时可将更多精力放在数据处理上。</p></li><li><p>但更高的灵活度意味着简单功能可能也需要复杂代码实现（或者根本实现不了，需要绕路😂），如果折腾精力不够，建议简单图还是使用传统绘图软件。</p></li><li><p>对于特别复杂的图，各种高端炫酷的以及3D类还是建议AI+PS（懂得都懂😏）、地理空间类则建议使用<code>Python</code>的<a href="https://geopandas.org/">Geopandas</a>，机器学习类的图也是<code>Python</code>提供的轮子更多。</p></li></ul><blockquote><p>ggplot2 虽好， 可不要贪杯🍻哦</p></blockquote><h2 id="Acknowledgements"><a href="#Acknowledgements" class="headerlink" title="Acknowledgements"></a>Acknowledgements</h2>   <a href="https://mattzou.com/2021/04/15/R-ggplot2/#Acknowledgements" class="card-body hover-with-bg" target="_blank" rel="noopener">     <div class="card-content">      <div class="link-avatar my-auto">        <img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/%E7%8C%B4%E5%AD%90%E5%A5%B3%E7%8E%8B.jpg" alt=""             onerror="this.onerror=null; this.srcset=null; this.src=''"/>      </div>       <div class="link-text">         <div class="link-title">🐒👑</div>         <div class="link-intro"></div>       </div>     </div>   </a>   <a href="https://mattzou.com/2021/04/15/R-ggplot2/#Acknowledgements" class="card-body hover-with-bg" target="_blank" rel="noopener">     <div class="card-content">      <div class="link-avatar my-auto">        <img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/%E6%96%87%E4%BB%B6%E4%BC%A0%E5%81%B7%E5%8A%A9%E7%90%86.jpg" alt=""             onerror="this.onerror=null; this.srcset=null; this.src=''"/>      </div>       <div class="link-text">         <div class="link-title">文件传偷助理</div>         <div class="link-intro"></div>       </div>     </div>   </a><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://ggplot2-book.org/index.html">ggplot2: elegant graphics for data analysis</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://ggplot2.tidyverse.org/reference/index.html">Function Reference</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://www.coder.work/article/6542920">r - 默认的ggplot2绘图边距是多少?</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://www.jianshu.com/p/5fbaf17d9aee">R语言基础绘图之边距参数</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a href="https://cran.r-project.org/web/packages/egg/vignettes/Ecosystem.html">Laying out multiple plots on a page</a><a href="#fnref:5" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:6" class="footnote-text"><span><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">Save a ggplot (or other grid object) with sensible defaults</a><a href="#fnref:6" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>目录</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ggplot2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>😏PPT系统🤣</title>
    <link href="/2021/04/10/Env-PPT%E7%B3%BB%E7%BB%9F/"/>
    <url>/2021/04/10/Env-PPT%E7%B3%BB%E7%BB%9F/</url>
    
    <content type="html"><![CDATA[<p>把之前的设计整合一下，勉强看看。</p><br><div class="row">    <embed src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/Environment/%E7%B3%BB%E7%BB%9F.pdf" width="100%" height="550" type="application/pdf"></div><br>]]></content>
    
    
    <categories>
      
      <category>环保</category>
      
    </categories>
    
    
    <tags>
      
      <tag>云服务</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mendeley 文献引用格式设置</title>
    <link href="/2021/04/03/Mendeley/"/>
    <url>/2021/04/03/Mendeley/</url>
    
    <content type="html"><![CDATA[<blockquote><p>最近使用Mendeley，研究了一下引文格式调整方法和技巧。</p></blockquote><span id="more"></span><h2 id="Mendeley文献引用格式设置"><a href="#Mendeley文献引用格式设置" class="headerlink" title="Mendeley文献引用格式设置"></a>Mendeley文献引用格式设置</h2><p><strong>注意：仅适用于Windows环境，当前测试环境：系统版本Win10 21313.1000，软件版本1.19.8</strong><br>Mendeley引文格式主要通过在线方式下载更新，对格式的自定义可通过其提供的CSL在线编辑器进行，同时Mendeley也支持本地编译好的CSL文件配置。</p><h3 id="引文格式配置文件"><a href="#引文格式配置文件" class="headerlink" title="引文格式配置文件"></a>引文格式配置文件</h3><p><a href="http://citationstyles.org/">Citation Style Language</a><br>CSL用于配置引文格式，Zotero、Mendeley等软件支持此方式定义引文格式。</p><h3 id="Mendeley中设置常用期刊引文方式"><a href="#Mendeley中设置常用期刊引文方式" class="headerlink" title="Mendeley中设置常用期刊引文方式"></a>Mendeley中设置常用期刊引文方式</h3><ol><li>点击菜单栏<code>View</code>-<code>Citation Style</code>-<code>More Styles...</code></li><li>弹出窗口中选择<code>Get More Styles</code><br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/Mendeley/Mendeley_install.jpg/pic" alt="安装"></li><li>搜索对应期刊下载安装即可</li></ol><h3 id="Mendeley中编辑引文格式"><a href="#Mendeley中编辑引文格式" class="headerlink" title="Mendeley中编辑引文格式"></a>Mendeley中编辑引文格式</h3><ol><li>在弹出窗口中查看已安装引文格式，右键<code>Edit Style</code>，跳转进入浏览器进行在线编辑<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/Mendeley/Mendeley_edit.jpg/pic" alt="编辑"></li><li>可视化编辑区域<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/Mendeley/Mendeley_online_edit.jpg/pic" alt="在线编辑"></li></ol><ul><li>左侧树结构，可分别对全局设置、文内引用、参考书目、引文组件进行设置</li><li>鼠标悬停于右侧示例上，左侧树会高亮显这块引文内容涉及的配置项目</li><li><strong>STYLE INFO</strong>中<code>Global Formatting Options</code>，<code>default-locale</code>项目可调整切换‘等‘与’<em>et al</em>‘，参数分别为’zh-CN‘、’en-US‘</li><li>文内引文(<strong>Inline Citations</strong>)和参考书目(<strong>Bibliography</strong>)<ul><li>由<code>Group</code>结构构成，<code>Group</code>内成员由<code>Macros</code>定义</li><li>点击根节点，其中<code>et-al-min</code>项目设置几个作者后出现’等‘</li><li><code>Sort</code>节点，定义文献排列顺序，按作者、时间等升降序规则，可定义多个规则，优先级由上至下</li></ul></li></ul><h3 id="本地CSL文件配置及使用"><a href="#本地CSL文件配置及使用" class="headerlink" title="本地CSL文件配置及使用"></a>本地CSL文件配置及使用</h3><ul><li>如果要使用[GB-T-7714] 相关CSL，可从以下repo下载<a href="https://github.com/redleafnew/Chinese-STD-GB-T-7714-related-csl">Chinese-STD-GB-T-7714-related-csl</a></li><li>Mendeley将所有CSL文件存储在如下路径<blockquote><p>C:\Users\{User}\AppData\Local\Mendeley Ltd\Mendeley Desktop\citationStyles-1.0</p></blockquote></li><li>将下载后的CSL移动到此目录</li><li>CSL文件类似XML样式，可以直接更改其中配置<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/Mendeley/Mendeley_CSL.jpg/pic" alt="本地配置"></li><li>文件修改保存后，在<code>More Styles...</code>窗口中已安装可见。</li></ul><h2 id="推荐插件"><a href="#推荐插件" class="headerlink" title="推荐插件"></a>推荐插件</h2><h3 id="Mendeley-Reference-Manager"><a href="#Mendeley-Reference-Manager" class="headerlink" title="Mendeley Reference Manager"></a><a href="https://www.mendeley.com/reference-management/reference-manager">Mendeley Reference Manager</a></h3><p><img src="https://cms-cdn.mendeley.com/prod/2021-03/stable_release_desktop_latest_mrm_img.png?qQFcGBSStKhraR6U0otl7yyd3t0ZQdBR"><br>Mendeley现在主推<strong>Mendeley Reference Manager</strong>，貌似有意取代现有<strong>Desktop</strong>软件，感觉就是一个套壳浏览器😂</p><h3 id="Mendeley-Web-Importer"><a href="#Mendeley-Web-Importer" class="headerlink" title="Mendeley Web Importer"></a><a href="https://www.mendeley.com/reference-management/web-importer">Mendeley Web Importer</a></h3><p><img src="https://cms-cdn.mendeley.com/prod/2019-09/web_importer_chrome_desktop.png?TOU3kk7tQZboiFYrIn90RYh1TyDQvaTg"><br>文献导入利器，浏览器随看随导，自动识别内容o(￣▽￣)ｄ</p>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mendeley</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>交通与GNN</title>
    <link href="/2020/12/11/Traffic-and-AI/"/>
    <url>/2020/12/11/Traffic-and-AI/</url>
    
    <content type="html"><![CDATA[<br><div class="row">    <embed src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/Environment/Traffic%20and%20AI.pdf" width="100%" height="550" type="application/pdf"></div><br>]]></content>
    
    
    <categories>
      
      <category>环保</category>
      
    </categories>
    
    
    <tags>
      
      <tag>交通</tag>
      
      <tag>GNN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ggplot2 添加注释</title>
    <link href="/2020/10/21/ggplot2-Annotation/"/>
    <url>/2020/10/21/ggplot2-Annotation/</url>
    
    <content type="html"><![CDATA[<p>主要介绍ggplot2添加图注释</p><h2 id="使用annotate"><a href="#使用annotate" class="headerlink" title="使用annotate()"></a>使用annotate()</h2><p>ggplot2 中提供各种灵活的方式添加注释，比如使用<code>geom_text, geom_rect, geom_line</code>等，但我更推荐使用<code>annotate()</code>进行标注。</p><p><code>annotate()</code>使用<code>vectors</code>中的值进行几何对象数据映射，相比<code>geom_</code>类从<strong>data frame</strong>映射数据更加轻便<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="Create an annotation layer">[1]</span></a></sup>。</p><h2 id="标注类型"><a href="#标注类型" class="headerlink" title="标注类型"></a>标注类型</h2><p><code>annotate()</code>通过第一个参数指定标注类型：</p><blockquote><p><code>&quot;text&quot;，&quot;rect&quot;，&quot;segment&quot;，&quot;pointrange&quot;，&quot;curve&quot;</code>，</p></blockquote><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ul><li><p>以坐标形式指定标注放置位置</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">p <span class="token operator">+</span> annotate<span class="token punctuation">(</span>    geom <span class="token operator">=</span> <span class="token string">"curve"</span><span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">35</span><span class="token punctuation">,</span> xend <span class="token operator">=</span> <span class="token number">2.65</span><span class="token punctuation">,</span> yend <span class="token operator">=</span> <span class="token number">27</span><span class="token punctuation">,</span>     curvature <span class="token operator">=</span> <span class="token number">.3</span><span class="token punctuation">,</span> arrow <span class="token operator">=</span> arrow<span class="token punctuation">(</span>length <span class="token operator">=</span> unit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"mm"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span> <span class="token operator">+</span>  annotate<span class="token punctuation">(</span>geom <span class="token operator">=</span> <span class="token string">"text"</span><span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token number">4.1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">35</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">"subaru"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/curve_annotation-1.png/pic"></p></li><li><p>对于<code>&quot;rect&quot;</code>型标注，通过设置 <code>ymin/ymax</code> 为 <code>+/-Inf</code>，绘制背景分区样式<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="Annotations">[2]</span></a></sup></p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">p <span class="token operator">+</span> geom_rect<span class="token punctuation">(</span>    aes<span class="token punctuation">(</span>xmin <span class="token operator">=</span> start<span class="token punctuation">,</span> xmax <span class="token operator">=</span> end<span class="token punctuation">,</span> fill <span class="token operator">=</span> party<span class="token punctuation">)</span><span class="token punctuation">,</span>     ymin <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">Inf</span><span class="token punctuation">,</span> ymax <span class="token operator">=</span> <span class="token number">Inf</span><span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">,</span>     data <span class="token operator">=</span> presidential  <span class="token punctuation">)</span> <span class="token operator">+</span>   scale_fill_manual<span class="token punctuation">(</span>values <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/unemp-pres-1.png/pic"></p></li><li><p>在Facet<a href="https://mattzou.com/2019/07/03/ggplot2-Facet/#%E4%B8%BA%E4%B8%8D%E5%90%8C%E5%AD%90%E5%9B%BE%E5%A2%9E%E5%8A%A0%E6%A0%87%E6%B3%A8">增加标注</a>参考此文。</p></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://ggplot2.tidyverse.org/reference/annotate.html">Create an annotation layer</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://ggplot2-book.org/annotations.html#annotations">Annotations</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ggplot2</tag>
      
      <tag>R</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ggplot2 使用expression添加公式与数学符号</title>
    <link href="/2020/07/16/ggplot2-Expression/"/>
    <url>/2020/07/16/ggplot2-Expression/</url>
    
    <content type="html"><![CDATA[<p>有时需要在图上标注诸如数学公式、上下标等符号，该操作可以通过<code>expression</code>函数完成。</p><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>如果在ggplot2中<code>text</code>参数是一个表达式形式（<code>expression</code>），则该参数将被根据类似TeX的规则对进行格式化输出。<code>expression</code>可用于标题，注释以及x轴和y轴标签<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="Mathematical Annotation in R">[1]</span></a></sup>。</p><p><code>expression</code>代码与输出的对应关系如图<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/expression.jpg/pic"></p><h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><h3 id="普通label"><a href="#普通label" class="headerlink" title="普通label"></a>普通label</h3><p>如果只是输出单独符号，则独立使用<strong>expression</strong>即可，如果组合复杂公式或添加文本描述，则在<strong>expression</strong>中使用<strong>paste</strong>进行拼接。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 全公式</span> labels <span class="token operator">=</span> expression<span class="token punctuation">(</span><span class="token operator">-</span>pi<span class="token punctuation">,</span> <span class="token operator">-</span>pi<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pi<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> pi<span class="token punctuation">)</span><span class="token comment"># 文本与符号组合</span> xlab <span class="token operator">=</span> expression<span class="token punctuation">(</span>paste<span class="token punctuation">(</span><span class="token string">"Phase Angle "</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div><h3 id="facet-grid-中的label"><a href="#facet-grid-中的label" class="headerlink" title="facet_grid()中的label"></a><code>facet_grid()</code>中的label</h3><p>需要将label解析方式设置为”label_parsed”<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="Formatting Math Symbols and Expressions in ggplot Labels">[2]</span></a></sup>。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">facet_grid<span class="token punctuation">(</span><span class="token operator">~</span> x<span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">"label_parsed"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><h3 id="annotate-中的label"><a href="#annotate-中的label" class="headerlink" title="annotate()中的label"></a><code>annotate()</code>中的label</h3><p><strong>text</strong>类型的标注，需将parse设置为TRUE。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">annotate<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> label <span class="token operator">=</span> expression<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parse <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://stat.ethz.ch/R-manual/R-devel/library/grDevices/html/plotmath.html">Mathematical Annotation in R</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://www.benjaminackerman.com/post/2019-03-08-equation_labels/">Formatting Math Symbols and Expressions in ggplot Labels</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    
    <tags>
      
      <tag>ggplot2</tag>
      
      <tag>R</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ggplot2 调整图例</title>
    <link href="/2020/07/14/ggplot2-Legend/"/>
    <url>/2020/07/14/ggplot2-Legend/</url>
    
    <content type="html"><![CDATA[<p>主要介绍ggplot2里Legend部分设置</p><p>ggplot2提供<code>guide_legend()</code>设置图例<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="Legend guide">[1]</span></a></sup>，更多参数可参考。</p><h2 id="常用设置"><a href="#常用设置" class="headerlink" title="常用设置"></a>常用设置</h2><p>以下设置在<code>theme()</code>中配置，常规设置请参考<a href="http://www.sthda.com/english/wiki/ggplot2-legend-easy-steps-to-change-the-position-and-the-appearance-of-a-graph-legend-in-r-software">此文</a>。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 图例位置与文字样式调整</span>legend.position <span class="token operator">=</span> <span class="token operator">|</span><span class="token string">"left"</span><span class="token punctuation">,</span> <span class="token string">"top"</span><span class="token punctuation">,</span> <span class="token string">"right"</span><span class="token punctuation">,</span> <span class="token string">"bottom"</span><span class="token punctuation">,</span> <span class="token string">"none"</span><span class="token operator">|</span>legend.text <span class="token operator">=</span> element_text<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span>legend.title <span class="token operator">=</span> element_text<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div><p>我自己绘图时还对以下内容进行设置。</p><h3 id="图例尺寸与边距"><a href="#图例尺寸与边距" class="headerlink" title="图例尺寸与边距"></a>图例尺寸与边距</h3><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 图例长宽</span> legend.key.size<span class="token operator">=</span>unit<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'mm'</span><span class="token punctuation">)</span> legend.key.width<span class="token operator">=</span>unit<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'mm'</span><span class="token punctuation">)</span><span class="token comment"># 图例与图的距离或两个图例之间距离</span> legend.margin<span class="token operator">=</span>margin<span class="token punctuation">(</span>b <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> unit<span class="token operator">=</span><span class="token string">'cm'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h3 id="图例文字与颜色映射"><a href="#图例文字与颜色映射" class="headerlink" title="图例文字与颜色映射"></a>图例文字与颜色映射</h3><p>对于<code>aes()</code>产生的图例，可以使用<code>scale_color_identity</code>或<code>scale_color_manual</code>两种方式自定义图例显示名称与颜色的映射关系<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="Creating legends when aesthetics are constants in ggplot2">[2]</span></a></sup></p><ol><li><code>aes</code>定义颜色描述，通过label指定文字描述<div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">ggplot<span class="token punctuation">(</span>mtcars<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>mpg<span class="token punctuation">,</span> hp<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">+</span>     geom_point<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>     geom_smooth<span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">"lm"</span><span class="token punctuation">,</span> se <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> aes<span class="token punctuation">(</span>color <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">+</span>     geom_smooth<span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">"lm"</span><span class="token punctuation">,</span> formula <span class="token operator">=</span> y <span class="token operator">~</span> poly<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> se <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> aes<span class="token punctuation">(</span>color <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>     geom_smooth<span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">"lm"</span><span class="token punctuation">,</span> formula <span class="token operator">=</span> y <span class="token operator">~</span> poly<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> se <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> aes<span class="token punctuation">(</span>color <span class="token operator">=</span> <span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>     scale_color_identity<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"Model fit"</span><span class="token punctuation">,</span>                          breaks <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          labels <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Linear"</span><span class="token punctuation">,</span> <span class="token string">"Quadratic"</span><span class="token punctuation">,</span> <span class="token string">"Cubic"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          guide <span class="token operator">=</span> <span class="token string">"legend"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li><li><code>aes</code>定义文字描述，通过value建立颜色映射<div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">ggplot<span class="token punctuation">(</span>mtcars<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>mpg<span class="token punctuation">,</span> hp<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">+</span>  geom_point<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>  geom_smooth<span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">"lm"</span><span class="token punctuation">,</span> se <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> aes<span class="token punctuation">(</span>color <span class="token operator">=</span> <span class="token string">"Linear"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">+</span>  geom_smooth<span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">"lm"</span><span class="token punctuation">,</span> formula <span class="token operator">=</span> y <span class="token operator">~</span> poly<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> se <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> aes<span class="token punctuation">(</span>color <span class="token operator">=</span> <span class="token string">"Quadratic"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>  geom_smooth<span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">"lm"</span><span class="token punctuation">,</span> formula <span class="token operator">=</span> y <span class="token operator">~</span> poly<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> se <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> aes<span class="token punctuation">(</span>color <span class="token operator">=</span> <span class="token string">"Cubic"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>  scale_color_manual<span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"Model fit"</span><span class="token punctuation">,</span>                     breaks <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Linear"</span><span class="token punctuation">,</span> <span class="token string">"Quadratic"</span><span class="token punctuation">,</span> <span class="token string">"Cubic"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     values <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Cubic"</span> <span class="token operator">=</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"Quadratic"</span> <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"Linear"</span> <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li></ol><h3 id="图例顺序"><a href="#图例顺序" class="headerlink" title="图例顺序"></a>图例顺序</h3><p>对于多个图例(size, shape, colour, alpha, fill等)，多个图例顺序调整方式如下</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># nrow调节行列数，order调节多个图例的顺序</span>p <span class="token operator">+</span> guides<span class="token punctuation">(</span>colour <span class="token operator">=</span> guide_legend<span class="token punctuation">(</span>nrow <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> order <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             fill <span class="token operator">=</span> guide_legend<span class="token punctuation">(</span>nrow <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> order <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h2 id="Open-air风玫瑰图图例Label定义"><a href="#Open-air风玫瑰图图例Label定义" class="headerlink" title="Open air风玫瑰图图例Label定义"></a>Open air风玫瑰图图例Label定义</h2><p>通过加入<code>key = list(labels = c())</code>进行定义，替换现有label<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="Changing the legend labels in a windrose from R openair">[3]</span></a></sup>。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">library<span class="token punctuation">(</span>openair<span class="token punctuation">)</span>windRose<span class="token punctuation">(</span>mydata<span class="token punctuation">,</span> ws<span class="token operator">=</span><span class="token string">"ws"</span><span class="token punctuation">,</span> wd<span class="token operator">=</span><span class="token string">"wd"</span><span class="token punctuation">,</span> breaks<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">3.3</span><span class="token punctuation">,</span><span class="token number">5.4</span><span class="token punctuation">,</span><span class="token number">7.9</span><span class="token punctuation">,</span><span class="token number">10.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          auto.text<span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> paddle <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> annotate <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span>         key <span class="token operator">=</span> list<span class="token punctuation">(</span>labels <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">Legend guide</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://aosmith.rbind.io/2018/07/19/manual-legends-ggplot2/">Creating legends when aesthetics are constants in ggplot2</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://databasefaq.com/index.php/answer/112135/r-legend-changing-the-legend-labels-in-a-windrose-from-r-openair">Changing the legend labels in a windrose from R openair</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ggplot2</tag>
      
      <tag>R</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>6-5环境日宣传ppt</title>
    <link href="/2020/06/06/Env-65%E7%8E%AF%E5%A2%83%E6%97%A5/"/>
    <url>/2020/06/06/Env-65%E7%8E%AF%E5%A2%83%E6%97%A5/</url>
    
    <content type="html"><![CDATA[<p>今年六五环境日主题“美丽中国，我是行动者”<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="生态环境部发布2020年六五环境日主题海报">[1]</span></a></sup>，智慧交通助力环保。</p><br><div class="row">    <embed src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/Environment/%E8%8E%86%E7%94%B065.pdf" width="100%" height="550" type="application/pdf"></div><br><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.mee.gov.cn/ywgz/xcjy/xccpzyk/hb/202005/t20200522_780328.shtml">生态环境部发布2020年六五环境日主题海报</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>环保</category>
      
    </categories>
    
    
    <tags>
      
      <tag>环境日</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GEE 常用卫星产品载入及显示</title>
    <link href="/2019/11/30/GEE%E7%AC%94%E8%AE%B0-%E4%BA%A7%E5%93%81%E6%98%BE%E7%A4%BA/"/>
    <url>/2019/11/30/GEE%E7%AC%94%E8%AE%B0-%E4%BA%A7%E5%93%81%E6%98%BE%E7%A4%BA/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在GEE平台code editor里显示卫星产品</p></blockquote><span id="more"></span><p>在GEE中，部分资产可以通过<a href="https://explorer.earthengine.google.com/#workspace">Explorer</a>进行预览，多数情况下下在<a href="https://code.earthengine.google.com/">Editor</a>里查看更为方便。</p><h2 id="Landsat-8"><a href="#Landsat-8" class="headerlink" title="Landsat 8"></a>Landsat 8</h2><div class="code-wrapper"><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> l8 <span class="token operator">=</span> ee<span class="token punctuation">.</span><span class="token function">ImageCollection</span><span class="token punctuation">(</span><span class="token string">"LANDSAT/LC08/C01/T1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    roi <span class="token operator">=</span>     ee<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span><span class="token function">Polygon</span><span class="token punctuation">(</span>        <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">119.23097080607909</span><span class="token punctuation">,</span> <span class="token number">36.93905749319195</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token number">119.23097080607909</span><span class="token punctuation">,</span> <span class="token number">32.21992180906591</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token number">124.09242100139159</span><span class="token punctuation">,</span> <span class="token number">32.21992180906591</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token number">124.09242100139159</span><span class="token punctuation">,</span> <span class="token number">36.93905749319195</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">var</span> Data_Collection <span class="token operator">=</span> l8<span class="token punctuation">.</span><span class="token function">filterDate</span><span class="token punctuation">(</span><span class="token string">'2016-05-01'</span><span class="token punctuation">,</span><span class="token string">'2016-08-30'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//选择云量最少的影像组合</span><span class="token keyword">var</span> Select_Collection<span class="token operator">=</span>  ee<span class="token punctuation">.</span>Algorithms<span class="token punctuation">.</span>Landsat<span class="token punctuation">.</span><span class="token function">simpleComposite</span><span class="token punctuation">(</span>Data_Collection<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clip</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span><span class="token comment">//载入图层</span>Map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>Select_Collection<span class="token punctuation">,</span><span class="token punctuation">&#123;</span>bands<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"B4"</span><span class="token punctuation">,</span><span class="token string">"B3"</span><span class="token punctuation">,</span><span class="token string">"B2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>gamma<span class="token operator">:</span> <span class="token number">1.5</span><span class="token punctuation">,</span>max<span class="token operator">:</span> <span class="token number">108</span><span class="token punctuation">,</span>min<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token string">'True-Color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Map<span class="token punctuation">.</span><span class="token function">centerObject</span><span class="token punctuation">(</span>roi<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h2 id="MODIS"><a href="#MODIS" class="headerlink" title="MODIS"></a>MODIS</h2><div class="code-wrapper"><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 选择数据源，并定义范围 roi</span><span class="token keyword">var</span> mod500 <span class="token operator">=</span> ee<span class="token punctuation">.</span><span class="token function">ImageCollection</span><span class="token punctuation">(</span><span class="token string">"MODIS/006/MYD09A1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    roi <span class="token operator">=</span>     ee<span class="token punctuation">.</span>Geometry<span class="token punctuation">.</span><span class="token function">Polygon</span><span class="token punctuation">(</span>        <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">118.96562188688824</span><span class="token punctuation">,</span> <span class="token number">36.08745610383932</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token number">118.96562188688824</span><span class="token punctuation">,</span> <span class="token number">34.000935416392934</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token number">121.29472344938824</span><span class="token punctuation">,</span> <span class="token number">34.000935416392934</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">[</span><span class="token number">121.29472344938824</span><span class="token punctuation">,</span> <span class="token number">36.08745610383932</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> image_mod500 <span class="token operator">=</span> ee<span class="token punctuation">.</span><span class="token function">Image</span><span class="token punctuation">(</span>     mod500<span class="token punctuation">.</span><span class="token function">filterDate</span><span class="token punctuation">(</span><span class="token string">'2016-05-01'</span><span class="token punctuation">,</span><span class="token string">'2016-08-30'</span>d<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clip</span><span class="token punctuation">(</span>roi<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Select the QA band</span><span class="token keyword">var</span> <span class="token constant">QA</span> <span class="token operator">=</span> image_mod500<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'StateQA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Get the cloud_state bits and find cloudy areas.</span><span class="token keyword">var</span> cloud <span class="token operator">=</span> <span class="token function">getQABits</span><span class="token punctuation">(</span><span class="token constant">QA</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'cloud_state'</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">expression</span><span class="token punctuation">(</span><span class="token string">"b(0) == 1 || b(0) == 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Create a mask that filters out  cloudy areas.</span><span class="token keyword">var</span> mask <span class="token operator">=</span> cloud<span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定义显示参数</span><span class="token keyword">var</span> visParams_color <span class="token operator">=</span> <span class="token punctuation">&#123;</span>bands<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'sur_refl_b01'</span><span class="token punctuation">,</span><span class="token string">'sur_refl_b04'</span><span class="token punctuation">,</span><span class="token string">'sur_refl_b03'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>min<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>max<span class="token operator">:</span><span class="token number">3000</span><span class="token punctuation">,</span>gamma<span class="token operator">:</span><span class="token number">1.3</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">//载入图层</span>Map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>image_mod500<span class="token punctuation">.</span><span class="token function">updatemask</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">,</span> visParams_color<span class="token punctuation">,</span> <span class="token string">'mod500_color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol><li><a href="https://www.zhihu.com/people/li-shi-wei-36">知乎用户 <strong>无形的风</strong></a></li></ol><ol start="2"><li><a href="https://www.zhihu.com/column/c_123993183">知乎专栏</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GEE</tag>
      
      <tag>遥感</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Google Earth Engine 教学视频笔记</title>
    <link href="/2019/11/30/GEE%E7%AC%94%E8%AE%B0/"/>
    <url>/2019/11/30/GEE%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<blockquote><p>B站上GEE基础视频要点笔记</p></blockquote><span id="more"></span><h2 id="基础数据类型："><a href="#基础数据类型：" class="headerlink" title="基础数据类型："></a>基础数据类型：</h2><h3 id="String、Number"><a href="#String、Number" class="headerlink" title="String、Number"></a>String、Number</h3><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee1.png/pic"></p><ul><li>基础运算：拼接、替换、切分</li><li>位运算用于云层处理<h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee2.png/pic"><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee3.png/pic"><h3 id="Dictionary"><a href="#Dictionary" class="headerlink" title="Dictionary"></a>Dictionary</h3><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee4.png/pic"></li><li>Add 添加内容，Insert 可以指定位置，map操作比较重要，循环使用</li></ul><h2 id="空间数据对象："><a href="#空间数据对象：" class="headerlink" title="空间数据对象："></a>空间数据对象：</h2><h3 id="Geometry"><a href="#Geometry" class="headerlink" title="Geometry"></a>Geometry</h3><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee5.png/pic"></p><ul><li>实现空间坐标变换，在<a href="https://epsg.io/">epsg</a>网站查找epsg代码填入参数</li><li><code>Geometry.distance()</code>  用于测算最近两点之间的距离<h3 id="Feature"><a href="#Feature" class="headerlink" title="Feature"></a>Feature</h3><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee6.png/pic"></li><li><code>Feature.Area()</code> 求面积<h3 id="Feature-Collection"><a href="#Feature-Collection" class="headerlink" title="Feature Collection"></a>Feature Collection</h3></li><li> 相当于arcgis shp编辑<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee7.png/pic"></li><li> reduceToImage 矢量转栅格<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee8.png/pic"></li><li> toLIst 变成列表元素<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee9.png/pic"><h3 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h3></li><li>Mask  掩膜操作  类似裁剪，但不真实删除元素<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee10.png/pic"></li><li> <code>Clip(geometry)</code>  裁剪操作</li><li><code>Select(‘bands’)</code>  波段名称选择   slice()  按波段index选择</li><li><code>Addbands()</code> 加波段</li><li><code>Reproject()</code>  epsg:3857 常用网络地图坐标代号</li><li>Rgb hsv 转换</li><li><code>where()</code>重新赋值  对小于4000的重赋值为0  可以剔除某些内容<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee11.png/pic"></li><li>数值判断，值域截取<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee12.png/pic"></li><li>自定义函数，计算NDVI时可用<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee13.png/pic"></li><li><code>Image.derivative()</code>高程进行x， y 微分 求坡度</li><li>纹理提取<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee14.png/pic"></li><li>临域操作，聚合替换<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee15.png/pic"><h3 id="Image-Collection"><a href="#Image-Collection" class="headerlink" title="Image Collection"></a>Image Collection</h3><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee16.png/pic"></li><li><code>Filter</code> 边界、时间段、数据属性筛选<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee17.png/pic"></li><li><code>mosaic()</code>实现多图叠加，将collection变一张image，重叠位置规则：后面取代前面<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee18.png/pic"></li><li><code>Select</code> 波段筛选并重命名，只能对同源数据操作<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee19.png/pic"></li><li>逻辑判断，Or 至少一次，and 多次<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee20.png/pic"></li><li> <code>unmixing</code>解决同物异谱或同谱异物<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee21.png/pic"></li></ul><h2 id="对象操作"><a href="#对象操作" class="headerlink" title="对象操作"></a>对象操作</h2><h3 id="Dates"><a href="#Dates" class="headerlink" title="Dates"></a>Dates</h3><ul><li>时间基本操作<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee22.png/pic"></li><li>时间表示方法<br>使用<a href="https://www.unixtimestamp.com/"><code>Unix timestamp</code></a>表示<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee23.png/pic"></li><li>时间段<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee24.png/pic"></li><li>时间段合并union<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee25.png/pic"></li></ul><h3 id="Filters"><a href="#Filters" class="headerlink" title="Filters"></a>Filters</h3><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee26.png/pic"></p><ul><li>筛选器操作步骤：<ol><li>获取集合</li><li>创建筛选器  f = Filter.xxxx()</li><li>对集合执行筛选器 collections.filter(f)</li></ol></li><li>内容筛选与获取<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee27.png/pic"></li><li>日期筛选<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee28.png/pic"></li><li>组合筛选<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee29.png/pic"><h3 id="Joins"><a href="#Joins" class="headerlink" title="Joins"></a>Joins</h3><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee30.png/pic"></li><li>左连接，定义筛选器筛选<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee31.png/pic"></li><li>影像产品结合<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee32.png/pic"></li><li>saveAll 只链接属性，类似ArcGIS join中字段连接</li><li>saveBest 参见guide<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee33.png/pic"></li></ul><h3 id="Reducers"><a href="#Reducers" class="headerlink" title="Reducers"></a>Reducers</h3><ul><li>主要用于栅格数据分析<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee34.png/pic"></li><li>计数，countEvery 可以计算NA<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee35.png/pic"></li><li>Reducers  max读取波段取最大， 或者多波段中位值<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee36.png/pic"><h3 id="Kernel"><a href="#Kernel" class="headerlink" title="Kernel"></a>Kernel</h3></li><li>对某一个栅格周围元素进行操作<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee37.png/pic"><br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee38.png/pic"></li><li> 对象识别与边界提取<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee39.png/pic"><br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/gee/gee40.png/pic"></li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol><li><a href="https://www.bilibili.com/video/BV1Sb411p7TQ">遥感大数据平台 Google Earth Engine 教学视频</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GEE</tag>
      
      <tag>遥感</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ggplot2 坐标轴调整</title>
    <link href="/2019/11/23/ggplot2-Axis/"/>
    <url>/2019/11/23/ggplot2-Axis/</url>
    
    <content type="html"><![CDATA[<p>坐标轴是ggplot2 中调整较多的部分，本文从数据映射和样式两个方面介绍坐标轴常用设置。</p><h2 id="数据映射"><a href="#数据映射" class="headerlink" title="数据映射"></a>数据映射</h2><h3 id="轴范围"><a href="#轴范围" class="headerlink" title="轴范围"></a>轴范围</h3><p>对于数值形式的轴，最简单的设置方式是直接使用<code>lims()</code>类函数<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="Set scale limits">[1]</span></a></sup>设置值域即可。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">p <span class="token operator">+</span> lims<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span>p <span class="token operator">+</span> xlim<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span>p <span class="token operator">+</span> ylim<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><blockquote><p>注意<br><code>lims</code>类操作对原始数据有操作，函数先根据范围过滤数据，再生成图。这对统计类图如<strong>boxplot</strong>造成很大影响，由于更改了数据，会使用错误统计结果绘图。多数情况下我们希望的范围限定是指图像裁切，即生成图后裁切多余的位置，因此对于统计类绘图使用<code>coord_cartesian</code>进行缩放更为安全<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="ggplot2中ylim的坑">[2]</span></a></sup>。</p></blockquote><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">p <span class="token operator">+</span> coord_cartesian<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><p>对于其他类型数据，在指定范围的同时，还需指定坐标间隔，使用以下系列函数<br><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_*_discrete</a>，<a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_*_continuous</a>，<a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_*_date</a></p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># limits指定范围，breaks指定间隔，labels定义新的标记</span><span class="token comment"># 离散型</span>p <span class="token operator">+</span> scale_x_discrete<span class="token punctuation">(</span>limits<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 连续型</span>p <span class="token operator">+</span> scale_x_continuous<span class="token punctuation">(</span>limits<span class="token punctuation">,</span> breaks<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># 时间型</span>p <span class="token operator">+</span> scale_x_date<span class="token punctuation">(</span>limits<span class="token punctuation">,</span> breaks<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h3 id="轴变换"><a href="#轴变换" class="headerlink" title="轴变换"></a>轴变换</h3><ul><li><p>log变换<br>有三种方式实现对数坐标轴变换<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="Position scales for continuous data (x &amp; y)">[3]</span></a></sup></p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 1.aes或数据集里直接变换</span>ggplot<span class="token punctuation">(</span>data<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token punctuation">,</span> y<span class="token operator">=</span>log10<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 2.scale_y_continuous 进行变换</span>p <span class="token operator">+</span> scale_y_continuous<span class="token punctuation">(</span>trans<span class="token operator">=</span><span class="token string">"log10"</span><span class="token punctuation">,</span>        breaks<span class="token operator">=</span>trans_breaks<span class="token punctuation">(</span><span class="token string">"log10"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token number">10</span><span class="token operator">^</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>        labels<span class="token operator">=</span>trans_format<span class="token punctuation">(</span><span class="token string">"log10"</span><span class="token punctuation">,</span>math_format<span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">^</span>.x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 3.scale_y_log10 函数</span>p <span class="token operator">+</span> scale_y_log10<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li><li><p>时间变换<br>使用<code>date_labels</code>进行时间转换<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="Date scale labels">[4]</span></a></sup></p><table><thead><tr class="header"><th align="left">String</th><th align="left">Meaning</th></tr></thead><tbody><tr class="odd"><td align="left"><code>%S</code></td><td align="left">second (00-59)</td></tr><tr class="even"><td align="left"><code>%M</code></td><td align="left">minute (00-59)</td></tr><tr class="odd"><td align="left"><code>%l</code></td><td align="left">hour, in 12-hour clock (1-12)</td></tr><tr class="even"><td align="left"><code>%I</code></td><td align="left">hour, in 12-hour clock (01-12)</td></tr><tr class="odd"><td align="left"><code>%p</code></td><td align="left">am/pm</td></tr><tr class="even"><td align="left"><code>%H</code></td><td align="left">hour, in 24-hour clock (00-23)</td></tr><tr class="odd"><td align="left"><code>%a</code></td><td align="left">day of week, abbreviated (Mon-Sun)</td></tr><tr class="even"><td align="left"><code>%A</code></td><td align="left">day of week, full (Monday-Sunday)</td></tr><tr class="odd"><td align="left"><code>%e</code></td><td align="left">day of month (1-31)</td></tr><tr class="even"><td align="left"><code>%d</code></td><td align="left">day of month (01-31)</td></tr><tr class="odd"><td align="left"><code>%m</code></td><td align="left">month, numeric (01-12)</td></tr><tr class="even"><td align="left"><code>%b</code></td><td align="left">month, abbreviated (Jan-Dec)</td></tr><tr class="odd"><td align="left"><code>%B</code></td><td align="left">month, full (January-December)</td></tr><tr class="even"><td align="left"><code>%y</code></td><td align="left">year, without century (00-99)</td></tr><tr class="odd"><td align="left"><code>%Y</code></td><td align="left">year, with century (0000-9999)</td></tr></tbody></table></li></ul><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">p <span class="token operator">+</span> scale_x_date<span class="token punctuation">(</span>date_breaks <span class="token operator">=</span> <span class="token string">"5 years"</span><span class="token punctuation">,</span> date_labels <span class="token operator">=</span> <span class="token string">"%y"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><h3 id="轴形态"><a href="#轴形态" class="headerlink" title="轴形态"></a>轴形态</h3><p>常用轴变换有以下三类</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># x\y轴自身翻转</span>p <span class="token operator">+</span> scale_<span class="token operator">*</span>_reverse<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># x与y轴交换</span>p <span class="token operator">+</span> coord_flip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 转换极坐标</span>p <span class="token operator">+</span> coord_polar<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h2 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h2><p>轴样式的定义在<code>theme</code>中以<strong>axis</strong>开头<sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" aria-label="GGPLOT AXIS TICKS: SET AND ROTATE TEXT LABELS">[5]</span></a></sup></p><blockquote><p><code>ticks</code>对应刻度线<br><code>text</code>对应标签<br><code>title</code>对应标题<br><code>line</code>对应轴线</p></blockquote><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/ggplot2-axis-ticks-example-1.png/pic"></p><h3 id="刻度线"><a href="#刻度线" class="headerlink" title="刻度线"></a>刻度线</h3><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 全局</span>  axis.ticks <span class="token operator">=</span> element_line<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token comment"># 只改变x轴     </span>  axis.ticks.x <span class="token operator">=</span> element_line<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span class="token comment"># 只改变y轴</span>  axis.ticks.y <span class="token operator">=</span> element_line<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span class="token comment"># 刻度线长度</span>  axis.ticks.length <span class="token operator">=</span> unit<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"pt"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h3 id="轴标签"><a href="#轴标签" class="headerlink" title="轴标签"></a>轴标签</h3><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 全局</span>  axis.text <span class="token operator">=</span> element_text<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token comment"># 只改变x轴    </span>  axis.text.x <span class="token operator">=</span> element_text<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span class="token comment"># 只改变顶端x轴（如果有）</span>  axis.text.x.top <span class="token operator">=</span> element_text<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span class="token comment"># 只改变y轴</span>  axis.text.y <span class="token operator">=</span> element_text<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span class="token comment"># 只改变右侧y轴（如果有）</span>  axis.text.y.right <span class="token operator">=</span> element_text<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h3 id="轴标题"><a href="#轴标题" class="headerlink" title="轴标题"></a>轴标题</h3><ul><li>定义标题样式<div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">axis.title.x <span class="token operator">=</span> element_text<span class="token punctuation">(</span><span class="token ellipsis">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li><li>轴标题旋转<div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># angle定义旋转角度</span><span class="token comment"># 由于旋转后文字会与坐标轴干涉冲突，可设置vjust或hjust偏移量调整</span>axis.title.y <span class="token operator">=</span> element_text<span class="token punctuation">(</span>angle <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> vjust <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></li></ul><h3 id="轴线"><a href="#轴线" class="headerlink" title="轴线"></a>轴线</h3><p>设置轴线宽度</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">axis.line.y <span class="token operator">=</span> element_line<span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><h3 id="移除"><a href="#移除" class="headerlink" title="移除"></a>移除</h3><p>如需移除相应内容</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">axis.<span class="token operator">*</span> <span class="token operator">=</span> element_blank<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://ggplot2.tidyverse.org/reference/lims.html">Set scale limits</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://www.jianshu.com/p/312d30049a25">ggplot2中ylim的坑</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">Position scales for continuous data (x &amp; y)</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://ggplot2-book.org/scale-position.html#date-labels">Date scale labels</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a href="https://www.datanovia.com/en/blog/ggplot-axis-ticks-set-and-rotate-text-labels/">GGPLOT AXIS TICKS: SET AND ROTATE TEXT LABELS</a><a href="#fnref:5" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ggplot2</tag>
      
      <tag>R</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ggplot2 双坐标轴实现</title>
    <link href="/2019/11/23/ggplot2-Dual-Axis/"/>
    <url>/2019/11/23/ggplot2-Dual-Axis/</url>
    
    <content type="html"><![CDATA[<p>按照ggplot2作者的思路，双y轴会降低图片的易读性，不推荐使用，所以ggplot2没有单独双y轴设置，这里有一系列关于双轴的讨论<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="Dual-Scaled Axes in Graphs Are They Ever the Best Solution?">[1]</span></a></sup><sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="A Study on Dual-Scale Data Charts">[2]</span></a></sup>。只能通过<code>scale_y_continuous()</code>与<code>sec.axis</code>属性迂回实现<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="Specify a secondary axis">[3]</span></a></sup>。</p><h2 id="定义第二轴"><a href="#定义第二轴" class="headerlink" title="定义第二轴"></a>定义第二轴</h2><p><code>sec.axis()</code>是<code>scale_y_continuous()</code>的属性，<code>sec.axis()</code>并非构建全新的Y轴。 它只是通过数学变换由第一个Y轴构建第二个Y轴。因此对于第二轴数据，在绘图前需要先按合适比例缩放，以保证缩放后值域在主轴数据值域内，随后绘制第二轴几何图形<strong>geom_x</strong>，再通过<code>sec.axis()</code>里的<code>trans</code>进行逆运算还原第二轴实际数值显示<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="Dual Y axis with R and ggplot2">[4]</span></a></sup>。</p><p>具体实现如下：</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 定义缩放系数，系数根据左右轴的值域比例确定，找公约数，这样可以保证网格线对齐</span>coeff <span class="token operator">&lt;-</span> <span class="token number">10</span>ggplot<span class="token punctuation">(</span>data<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x<span class="token operator">=</span>day<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>  <span class="token comment"># 主轴几何对象正常绘制</span>  geom_line<span class="token punctuation">(</span> aes<span class="token punctuation">(</span>y<span class="token operator">=</span>temperature<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>   <span class="token comment"># 第二轴数据在绘制几何图形时进行缩放至主轴值域</span>  geom_line<span class="token punctuation">(</span> aes<span class="token punctuation">(</span>y<span class="token operator">=</span>price <span class="token operator">/</span> coeff<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>   scale_y_continuous<span class="token punctuation">(</span>    <span class="token comment"># 设置第一轴，左侧主轴</span>    name <span class="token operator">=</span> <span class="token string">"First Axis"</span><span class="token punctuation">,</span>    <span class="token comment"># 增加右侧第二轴，并通过系数还原值显示</span>    sec.axis <span class="token operator">=</span> sec_axis<span class="token punctuation">(</span><span class="token operator">~</span>.<span class="token operator">*</span>coeff<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"Second Axis"</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p><img src="https://www.r-graph-gallery.com/line-chart-dual-Y-axis-ggplot2_files/figure-html/thecode3-1.png"><br>这里有相关例子可以参考辅助理解<sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" aria-label="ggplot2: Secondary Y axis">[5]</span></a></sup>。</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="http://www.perceptualedge.com/articles/visual_business_intelligence/dual-scaled_axes.pdf">Dual-Scaled Axes in Graphs Are They Ever the Best Solution?</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://www.lri.fr/~isenberg/publications/papers/Isenberg_2011_ASO.pdf">A Study on Dual-Scale Data Charts</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html">Specify a secondary axis</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://www.r-graph-gallery.com/line-chart-dual-Y-axis-ggplot2.html">Dual Y axis with R and ggplot2</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a href="https://whatalnk.github.io/r-tips/ggplot2-secondary-y-axis.nb.html">ggplot2: Secondary Y axis</a><a href="#fnref:5" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ggplot2</tag>
      
      <tag>R</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ArcGIS 上下角标</title>
    <link href="/2019/07/07/ArcGIS-%E4%B8%8A%E4%B8%8B%E8%A7%92%E6%A0%87/"/>
    <url>/2019/07/07/ArcGIS-%E4%B8%8A%E4%B8%8B%E8%A7%92%E6%A0%87/</url>
    
    <content type="html"><![CDATA[<p>绘制专题图时，Legend或Title部分存在上下标。</p><span id="more"></span><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>ArcGIS标注系统支持类html标签，直接在文本设置中填入对应角标即可。<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ArcGIS/Arcgis_%E8%A7%92%E6%A0%87.jpg/pic" alt="上下标"></p><h3 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h3><p>其他受支持的标签如下</p><table><thead>  <tr>    <th>元素描述</th>    <th>起始标签</th>    <th>结束标签</th>    <th>有效的属性值</th>    <th>备注</th>  </tr></thead><tbody>  <tr>    <td>字体名称和/或字号</td>    <td>&lt;FNT&gt;</td>    <td>&lt;/FNT&gt;</td>    <td>name = {TrueType font} size = {1} scale = {1-}</td>    <td>设置名称、大小和比例，或全部设置。</td>  </tr>  <tr>    <td>颜色(RGB)</td>    <td>&lt;CLR&gt;</td>    <td>&lt;/CLR&gt;</td>    <td>red, green, blue = {0-255}</td>    <td>缺失的颜色属性假定为 0</td>  </tr>  <tr>    <td>颜色 (CMYK)</td>    <td>&lt;CLR&gt;</td>    <td>&lt;/CLR&gt;</td>    <td>cyan, magenta, yellow, black = {0-100}</td>    <td>缺失的颜色属性假定为 0</td>  </tr>  <tr>    <td>粗体</td>    <td>&lt;BOL&gt;</td>    <td>&lt;/BOL&gt;</td>    <td>无</td>    <td> </td>  </tr>  <tr>    <td>斜体</td>    <td>&lt;ITA&gt;</td>    <td>&lt;/ITA&gt;</td>    <td>无</td>    <td> </td>  </tr>  <tr>    <td>下划线</td>    <td>&lt;UND&gt;</td>    <td>&lt;/UND&gt;</td>    <td>无</td>    <td> </td>  </tr>  <tr>    <td>全部大写</td>    <td>&lt;ACP&gt;</td>    <td>&lt;/ACP&gt;</td>    <td>无</td>    <td> </td>  </tr>  <tr>    <td>小型大写字母</td>    <td>&lt;SCP&gt;</td>    <td>&lt;/SCP&gt;</td>    <td>无</td>    <td> </td>  </tr>  <tr>    <td>上标</td>    <td>&lt;SUP&gt;</td>    <td>&lt;/SUP&gt;</td>    <td>无</td>    <td> </td>  </tr>  <tr>    <td>下标</td>    <td>&lt;SUB&gt;</td>    <td>&lt;/SUB&gt;</td>    <td>无</td>    <td> </td>  </tr>  <tr>    <td>字符间距</td>    <td>&lt;CHR&gt;</td>    <td>&lt;/CHR&gt;</td>    <td>spacing = {1-}</td>    <td>表示相对于常规字符间距的调整百分比；0% 表示没有调整。</td>  </tr>  <tr>    <td>字符宽度</td>    <td>&lt;CHR&gt;</td>    <td>&lt;/CHR&gt;</td>    <td> </td>    <td>表示相对于常规字符宽度的调整百分比；0% 表示没有调整。</td>  </tr>  <tr>    <td>词间距</td>    <td>&lt;WRD&gt;</td>    <td>&lt;/WRD&gt;</td>    <td>spacing = {1-}</td>    <td>表示词间的间距百分比；100% 表示常规间距。</td>  </tr>  <tr>    <td>行间距</td>    <td>&lt;LIN&gt;</td>    <td>&lt;/LIN&gt;</td>    <td>leading = {1-}</td>    <td>表示相对于常规行间距的调整（单位为磅）；0 磅表示没有调整。</td>  </tr>  <tr>    <td>不加粗</td>    <td>&lt;_BOL&gt;</td>    <td>&lt;/BOL&gt;</td>    <td>无</td>    <td> </td>  </tr>  <tr>    <td>不倾斜</td>    <td>&lt;_ITA&gt;</td>    <td>&lt;/_ITA&gt;</td>    <td>无</td>    <td> </td>  </tr>  <tr>    <td>不加下划线</td>    <td>&lt;_UND&gt;</td>    <td>&lt;/_UND&gt;</td>    <td>无</td>    <td> </td>  </tr>  <tr>    <td>不加上标</td>    <td>&lt;_SUP&gt;</td>    <td>&lt;/_SUP&gt;</td>    <td>无</td>    <td> </td>  </tr>  <tr>    <td>不加下标</td>    <td>&lt;_SUB&gt;</td>    <td>&lt;/_SUB&gt;</td>    <td>无</td>    <td> </td>  </tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ArcGIS</tag>
      
      <tag>角标</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ggplot2 分面绘图</title>
    <link href="/2019/07/03/ggplot2-Facet/"/>
    <url>/2019/07/03/ggplot2-Facet/</url>
    
    <content type="html"><![CDATA[<p>主要介绍ggplot2里Facetting使用要点。</p><p><code>Facetting</code>用于将图以面板矩阵的形式分成多个子图进行绘制，主要通过以下函数实现<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="Facetting">[1]</span></a></sup>。</p><ul><li><code>facet_grid()</code></li><li><code>facet_wrap()</code></li></ul><p>一些常规设置参考此文<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="ggplot2 facet : split a plot into a matrix of panels">[2]</span></a></sup>，下面是我使用时调整的一些内容。</p><h2 id="面板标签模块设置"><a href="#面板标签模块设置" class="headerlink" title="面板标签模块设置"></a>面板标签模块设置</h2><h3 id="Label替换"><a href="#Label替换" class="headerlink" title="Label替换"></a>Label替换</h3><p>这部分内容在<code>facet_grid/warp()</code>里调整<br>  <div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 构造替换字典</span><span class="token comment"># 新label</span>supp.labs <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"Orange Juice"</span><span class="token punctuation">,</span> <span class="token string">"Vitamin C"</span><span class="token punctuation">)</span><span class="token comment"># 原label</span>names<span class="token punctuation">(</span>supp.labs<span class="token punctuation">)</span> <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"OJ"</span><span class="token punctuation">,</span> <span class="token string">"VC"</span><span class="token punctuation">)</span><span class="token comment"># 在labeller中进行替换</span>p <span class="token operator">+</span> facet_grid<span class="token punctuation">(</span>  . <span class="token operator">~</span> supp<span class="token punctuation">,</span>   labeller <span class="token operator">=</span> labeller<span class="token punctuation">(</span>supp <span class="token operator">=</span> supp.labs<span class="token punctuation">)</span>  <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></p><h3 id="字体及背景色"><a href="#字体及背景色" class="headerlink" title="字体及背景色"></a>字体及背景色</h3><p>这部分在<code>theme()</code>里调整，与分面相关的属性以<strong>strip</strong>开头。<br>  <div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">theme<span class="token punctuation">(</span>     <span class="token comment"># 文字样式调整</span>     strip.text.x <span class="token operator">=</span> element_text<span class="token punctuation">(</span>     size <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">,</span> face <span class="token operator">=</span> <span class="token string">"bold.italic"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token comment"># 标签背景色调整，fill表示填充色，color表示边框颜色</span>     strip.background <span class="token operator">=</span> element_rect<span class="token punctuation">(</span>     color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token string">"#FC4E07"</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span> linetype<span class="token operator">=</span><span class="token string">"solid"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></p><h3 id="为不同子图增加标注"><a href="#为不同子图增加标注" class="headerlink" title="为不同子图增加标注"></a>为不同子图增加标注</h3><p>从<code>facet_</code>实现考虑，分页字段可以看作子图索引（二维），因此通过创建包含分页字段的标注子数据集，在绘图时就可以在指定子图上加入特定标注<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="Adding different annotation to each facet in ggplot">[3]</span></a></sup>。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 载入包</span>library<span class="token punctuation">(</span>ggplot2<span class="token punctuation">)</span>library<span class="token punctuation">(</span>Rmisc<span class="token punctuation">)</span><span class="token comment"># 载入数据</span>butter <span class="token operator">&lt;-</span> read.table<span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">,</span> header <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token comment"># summary数据</span>buttersum <span class="token operator">&lt;-</span> summarySE<span class="token punctuation">(</span>data <span class="token operator">=</span> butter<span class="token punctuation">,</span> measurevar <span class="token operator">=</span> <span class="token string">"winglen"</span><span class="token punctuation">,</span>                      groupvars <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"spp"</span><span class="token punctuation">,</span> <span class="token string">"sex"</span><span class="token punctuation">,</span> <span class="token string">"region"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 为标注创建数据集，包含region这个分面字段，这一步是关键</span>anno <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>x1 <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1.75</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x2 <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2.25</span><span class="token punctuation">,</span> <span class="token number">1.25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    y1 <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y2 <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    xstar <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ystar <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                   lab <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"***"</span><span class="token punctuation">,</span> <span class="token string">"**"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                   region <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"North"</span><span class="token punctuation">,</span> <span class="token string">"South"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p>标注形态如下<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/diag2-14.png"></p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 绘制图像，选择region作为分面</span>ggplot<span class="token punctuation">(</span>data <span class="token operator">=</span> buttersum<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> spp<span class="token punctuation">,</span> y <span class="token operator">=</span> winglen<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>  geom_point<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>shape <span class="token operator">=</span> sex<span class="token punctuation">)</span><span class="token punctuation">,</span> position <span class="token operator">=</span> position_dodge<span class="token punctuation">(</span>width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span>  scale_shape_manual<span class="token punctuation">(</span>values <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">,</span> labels <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Female"</span><span class="token punctuation">,</span> <span class="token string">"Male"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token operator">+</span>  geom_errorbar<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>group <span class="token operator">=</span> sex<span class="token punctuation">,</span> ymin <span class="token operator">=</span> winglen <span class="token operator">-</span> se<span class="token punctuation">,</span> ymax <span class="token operator">=</span> winglen <span class="token operator">+</span> se<span class="token punctuation">)</span><span class="token punctuation">,</span>                 width <span class="token operator">=</span> <span class="token number">.2</span><span class="token punctuation">,</span> position <span class="token operator">=</span> position_dodge<span class="token punctuation">(</span>width <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>  geom_text<span class="token punctuation">(</span>data <span class="token operator">=</span> anno<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> xstar<span class="token punctuation">,</span>  y <span class="token operator">=</span> ystar<span class="token punctuation">,</span> label <span class="token operator">=</span> lab<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>  geom_segment<span class="token punctuation">(</span>data <span class="token operator">=</span> anno<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> x1<span class="token punctuation">,</span> xend <span class="token operator">=</span> x1<span class="token punctuation">,</span>            y <span class="token operator">=</span> y1<span class="token punctuation">,</span> yend <span class="token operator">=</span> y2<span class="token punctuation">)</span><span class="token punctuation">,</span>           colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">)</span> <span class="token operator">+</span>  geom_segment<span class="token punctuation">(</span>data <span class="token operator">=</span> anno<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> x2<span class="token punctuation">,</span> xend <span class="token operator">=</span> x2<span class="token punctuation">,</span>            y <span class="token operator">=</span> y1<span class="token punctuation">,</span> yend <span class="token operator">=</span> y2<span class="token punctuation">)</span><span class="token punctuation">,</span>           colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">)</span> <span class="token operator">+</span>  geom_segment<span class="token punctuation">(</span>data <span class="token operator">=</span> anno<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> x1<span class="token punctuation">,</span> xend <span class="token operator">=</span> x2<span class="token punctuation">,</span>            y <span class="token operator">=</span> y2<span class="token punctuation">,</span> yend <span class="token operator">=</span> y2<span class="token punctuation">)</span><span class="token punctuation">,</span>           colour <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">)</span><span class="token operator">+</span>  facet_grid<span class="token punctuation">(</span>. <span class="token operator">~</span> region<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/annofacet-15.png"></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://ggplot2.tidyverse.org/reference/index.html#section-facetting">Facetting</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="http://www.sthda.com/english/wiki/ggplot2-facet-split-a-plot-into-a-matrix-of-panels">ggplot2 facet : split a plot into a matrix of panels</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://buzzrbeeline.blog/2018/11/06/adding-different-annotation-to-each-facet-in-ggplot/">Adding different annotation to each facet in ggplot</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ggplot2</tag>
      
      <tag>R</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ggplot2 颜色配置</title>
    <link href="/2019/04/21/ggplot2-Color/"/>
    <url>/2019/04/21/ggplot2-Color/</url>
    
    <content type="html"><![CDATA[<p>ggplot2主要通过<code>FILL</code>和<code>COLOR</code>属性设置几何对象的颜色，可以直接指定某一种颜色，让颜色随变量自动配置或者使用调色板设置颜色<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="Dealing with colors in ggplot2">[1]</span></a></sup>。</p><h2 id="色彩代码"><a href="#色彩代码" class="headerlink" title="色彩代码"></a>色彩代码</h2><p>对于单个颜色选择，可以参考R语言绘图颜色对照表，其中包含了几乎可以用到的颜色代码<br><br></p><div class="row">    <embed src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/ColorChart.pdf" width="100%" height="550" type="application/pdf"></div><br><h2 id="调色板"><a href="#调色板" class="headerlink" title="调色板"></a>调色板</h2><p>对于连续色阶或者多种色彩搭配，官方建议使用<code>RColorBrewer</code>提供的调色板。<br>ggplot2原生支持通过设置<code>palette</code>来切换调色板<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="ggplot2 colors : How to change colors automatically and manually?">[2]</span></a></sup>，<a href="https://www.r-graph-gallery.com/38-rcolorbrewers-palettes.html">这里</a>提供了预设<code>ColorBrewer</code>调色板代号及预览。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">p <span class="token operator">+</span> scale_color_brewer<span class="token punctuation">(</span>palette <span class="token operator">=</span> <span class="token string">"PuOr"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><p><img src="https://www.r-graph-gallery.com/38-rcolorbrewers-palettes_files/figure-html/thecode-1.png"></p><p>另外一种官方原生支持的色板<code>Viridis</code>，<a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html">这里</a>有预设色板。这个色板以连续颜色为主，也可以通过设置<code>discrete=TRUE</code>属性使用离散色阶。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">p <span class="token operator">+</span> scale_color_viridis<span class="token punctuation">(</span>option<span class="token operator">=</span><span class="token string">"magma"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/viridis.png/pic"></p><p>此外还可通过<a href="https://cran.r-project.org/web/packages/ggsci/vignettes/ggsci.html">ggsci</a>或者<a href="https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/">ggthemes</a>选择合适的调色板<br><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ggplot2/ggthemes-1.png/pic"></p><h3 id="调色板hex代码查看"><a href="#调色板hex代码查看" class="headerlink" title="调色板hex代码查看"></a>调色板hex代码查看</h3><ul><li><a href="https://colorbrewer2.org/#type=sequential&scheme=BuGn&n=3">这里</a>提供了<code>ColorBrewer</code>调色板动态预览及hex代码查看。</li><li>获取其他调色板hex<div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">library<span class="token punctuation">(</span>paletteer<span class="token punctuation">)</span>paletteer_c<span class="token punctuation">(</span>package <span class="token operator">=</span> <span class="token string">"scico"</span><span class="token punctuation">,</span> palette <span class="token operator">=</span> <span class="token string">"berlin"</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></li><li>ggplot2 默认调色板查看<div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">library<span class="token punctuation">(</span>scales<span class="token punctuation">)</span> <span class="token comment"># n为色板阶数</span>show_col<span class="token punctuation">(</span>hue_pal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></li></ul><h3 id="自定义调色板"><a href="#自定义调色板" class="headerlink" title="自定义调色板"></a>自定义调色板</h3><p>当以上色板无法满足需求，可以通过以下方式自定义色板<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="R语言作图：自定义调色盘">[3]</span></a></sup>。</p><ul><li>生成色板<br>主要使用<code>colorRampPalette</code>，详见<a href="https://www.rdocumentation.org/packages/dichromat/versions/1.1/topics/colorRampPalette">文档</a><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 定义基准色</span>cols<span class="token operator">&lt;-</span>c<span class="token punctuation">(</span><span class="token string">'#E64E00'</span><span class="token punctuation">,</span><span class="token string">'#65B48E'</span><span class="token punctuation">,</span><span class="token string">'#E6EB00'</span><span class="token punctuation">,</span><span class="token string">'#E64E00'</span><span class="token punctuation">)</span><span class="token comment"># 生成色板 20 色阶</span><span class="token comment"># bias用于设置色阶偏移 Bias >1 puts more colors at high values</span>pal<span class="token operator">&lt;-</span>colorRampPalette<span class="token punctuation">(</span>cols<span class="token punctuation">,</span> bias <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">)</span>image<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span>y<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>z<span class="token operator">=</span>as.matrix<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>col<span class="token operator">=</span>pal<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li><li>查看色板<div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">pal<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token string">"#3E5CC5"</span> <span class="token string">"#4469BC"</span> <span class="token string">"#4A77B3"</span> <span class="token string">"#5085AA"</span> <span class="token string">"#5693A2"</span> <span class="token string">"#5CA199"</span> <span class="token string">"#62AF90"</span> <span class="token string">"#72B97F"</span> <span class="token string">"#86C268"</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token string">"#9BCB52"</span> <span class="token string">"#AFD33B"</span> <span class="token string">"#C4DC25"</span> <span class="token string">"#D8E50E"</span> <span class="token string">"#E6E200"</span> <span class="token string">"#E6C900"</span> <span class="token string">"#E6B100"</span> <span class="token string">"#E69800"</span> <span class="token string">"#E67F00"</span><span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> <span class="token string">"#E66600"</span> <span class="token string">"#E64E00"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li><li>使用色板<br>若使用时n小于设置阶数，则从左开始截断使用。<div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 连续型</span>p <span class="token operator">+</span> scale_color_gradientn<span class="token punctuation">(</span>colors <span class="token operator">=</span> pal<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 离散型</span>p <span class="token operator">+</span> scale_color_manual<span class="token punctuation">(</span>colors <span class="token operator">=</span> pal<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.r-graph-gallery.com/ggplot2-color.html">Dealing with colors in ggplot2</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="http://www.sthda.com/english/wiki/ggplot2-colors-how-to-change-colors-automatically-and-manually">ggplot2 colors : How to change colors automatically and manually?</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://zhuanlan.zhihu.com/p/144764468">R语言作图：自定义调色盘</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ggplot2</tag>
      
      <tag>R</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ggplot2 添加拟合线及公式</title>
    <link href="/2019/04/21/ggplot2-Lines/"/>
    <url>/2019/04/21/ggplot2-Lines/</url>
    
    <content type="html"><![CDATA[<p>主要介绍ggplot2里拟合线与公式设置</p><h2 id="使用ggpmisc"><a href="#使用ggpmisc" class="headerlink" title="使用ggpmisc()"></a>使用ggpmisc()</h2><p>stat_smooth + stat_poly_eq组合实现拟合曲线以及拟合公式显示。</p><p>stat_poly_eq用于显示公式，支持以下统计参数显示<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="Equation, p-value, R^2, AIC or BIC of fitted polynomial">[1]</span></a></sup>：</p><blockquote><p>eq.label<br>equation for the fitted polynomial as a character string to be parsed</p></blockquote><blockquote><p>rr.label<br>R2 of the fitted model as a character string to be parsed</p></blockquote><blockquote><p>adj.rr.label<br>Adjusted R2 of the fitted model as a character string to be parsed</p></blockquote><blockquote><p>f.value.label<br>F value and degrees of freedom for the fitted model as a whole.</p></blockquote><blockquote><p>p.value..label<br>P-value for the F-value above.</p></blockquote><blockquote><p>AIC.label<br>AIC for the fitted model.</p></blockquote><blockquote><p>BIC.label<br>BIC for the fitted model.</p></blockquote><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 定义公式类型</span>formula <span class="token operator">&lt;-</span> y <span class="token operator">~</span> x <span class="token operator">+</span> I<span class="token punctuation">(</span>x<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment"># 添加拟合线</span>P <span class="token operator">+</span> geom_smooth<span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">"lm"</span><span class="token punctuation">,</span> formula <span class="token operator">=</span> formula<span class="token punctuation">)</span><span class="token comment"># 添加公式</span>p <span class="token operator">+</span> stat_poly_eq<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>label <span class="token operator">=</span>  paste<span class="token punctuation">(</span>stat<span class="token punctuation">(</span>eq.label<span class="token punctuation">)</span><span class="token punctuation">,</span> stat<span class="token punctuation">(</span>adj.rr.label<span class="token punctuation">)</span><span class="token punctuation">,</span>                 sep <span class="token operator">=</span> <span class="token string">"*\", \"*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> formula <span class="token operator">=</span> formula<span class="token punctuation">,</span> parse <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token comment"># 添加参数表</span>p <span class="token operator">+</span> stat_fit_tb<span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">"lm"</span><span class="token punctuation">,</span>              method.args <span class="token operator">=</span> list<span class="token punctuation">(</span>formula <span class="token operator">=</span> formula<span class="token punctuation">)</span><span class="token punctuation">,</span>              tb.type <span class="token operator">=</span> <span class="token string">"fit.anova"</span><span class="token punctuation">,</span>              tb.vars <span class="token operator">=</span> c<span class="token punctuation">(</span>Effect <span class="token operator">=</span> <span class="token string">"term"</span><span class="token punctuation">,</span>                           <span class="token string">"df"</span><span class="token punctuation">,</span>                          <span class="token string">"M.S."</span> <span class="token operator">=</span> <span class="token string">"meansq"</span><span class="token punctuation">,</span>                           <span class="token string">"italic(F)"</span> <span class="token operator">=</span> <span class="token string">"statistic"</span><span class="token punctuation">,</span>                           <span class="token string">"italic(P)"</span> <span class="token operator">=</span> <span class="token string">"p.value"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              label.y <span class="token operator">=</span> <span class="token number">0.87</span><span class="token punctuation">,</span> label.x <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">,</span>              size <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>              parse <span class="token operator">=</span> <span class="token boolean">TRUE</span>  <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p>stat_poly_eq显示p-value<code>stat(p.value.label)</code>，p显示为大写<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="“ p值”的正确拼写（大写，斜体，连字符）吗？">[2]</span></a></sup>，如果需要改为小写斜体<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="Can we neatly align the regression equation and R2 and p value?">[3]</span></a></sup></p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 将stat(p.value.label) 替换为</span>paste<span class="token punctuation">(</span><span class="token string">"italic(p)"</span><span class="token punctuation">,</span> substring<span class="token punctuation">(</span>p.value.label<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div><h3 id="对数指数形式"><a href="#对数指数形式" class="headerlink" title="对数指数形式"></a>对数指数形式</h3><p><code>stat_poly_eq</code>在显示指数或对数函数时总出现问题，因此考虑采用geom_line + geom_ribbon + annotate方式迂回实现<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="How to visulaize linear model prediction in ggplot along with confidence interval?">[4]</span></a></sup>。</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 公式拟合</span>log.model <span class="token operator">&lt;-</span>lm<span class="token punctuation">(</span>log<span class="token punctuation">(</span>Frequency<span class="token punctuation">)</span> <span class="token operator">~</span> Coverage<span class="token punctuation">,</span> area<span class="token punctuation">)</span><span class="token comment"># 用于geom_ribbon显示CI</span>observeddata <span class="token operator">&lt;-</span> cbind<span class="token punctuation">(</span>area<span class="token punctuation">,</span> predict<span class="token punctuation">(</span>log.model<span class="token punctuation">,</span> newdata <span class="token operator">=</span> area<span class="token punctuation">,</span> interval <span class="token operator">=</span> <span class="token string">'confidence'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 组合生成拟合线与公式</span>p <span class="token operator">+</span> geom_ribbon<span class="token punctuation">(</span>data <span class="token operator">=</span> observeddata<span class="token punctuation">,</span>                 aes<span class="token punctuation">(</span>x <span class="token operator">=</span> Coverage<span class="token punctuation">,</span> y <span class="token operator">=</span> exp<span class="token punctuation">(</span>fit<span class="token punctuation">)</span><span class="token punctuation">,</span> ymin <span class="token operator">=</span> exp<span class="token punctuation">(</span>lwr<span class="token punctuation">)</span><span class="token punctuation">,</span> ymax <span class="token operator">=</span> exp<span class="token punctuation">(</span>upr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token operator">+</span>   geom_line<span class="token punctuation">(</span>data <span class="token operator">=</span> log.model.df<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>Coverage<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span> <span class="token operator">+</span>   annotate<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token ellipsis">...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h2 id="使用ggPredict"><a href="#使用ggPredict" class="headerlink" title="使用ggPredict()"></a>使用ggPredict()</h2><p><code>ggPredict</code>提供了拟合曲线的封装函数，相比ggplot2原生绘制，更为简单，同时支持lm()，glm()等拟合方式<sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" aria-label="ggPredict-Visualize multiple regression model">[5]</span></a></sup>。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span><span class="token string">"devtools"</span><span class="token punctuation">)</span>devtools<span class="token operator">::</span>install_github<span class="token punctuation">(</span><span class="token string">"cardiomoon/ggiraphExtra"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div><h3 id="对比原生方法"><a href="#对比原生方法" class="headerlink" title="对比原生方法"></a>对比原生方法</h3><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 载入样例数据</span>require<span class="token punctuation">(</span>moonBook<span class="token punctuation">)</span><span class="token comment"># 拟合 </span>fit <span class="token operator">=</span> lm<span class="token punctuation">(</span>NTAV<span class="token operator">~</span>age<span class="token punctuation">,</span> data <span class="token operator">=</span> radial<span class="token punctuation">)</span><span class="token comment"># 使用ggplot的 geom_smooth 绘制</span>ggplot<span class="token punctuation">(</span>radial<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>y <span class="token operator">=</span> NTAV<span class="token punctuation">,</span>x <span class="token operator">=</span> age<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> geom_point<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> geom_smooth<span class="token punctuation">(</span>method <span class="token operator">=</span> <span class="token string">"lm"</span><span class="token punctuation">)</span><span class="token comment"># 使用ggPredict绘制</span>ggPredict<span class="token punctuation">(</span>fit<span class="token punctuation">,</span> se <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> interactive <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://docs.r4photobiology.info/ggpmisc/reference/stat_poly_eq.html">Equation, p-value, R^2, AIC or BIC of fitted polynomial</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://qastack.cn/stats/871/correct-spelling-capitalization-italicization-hyphenation-of-p-value">“ p值”的正确拼写（大写，斜体，连字符）吗？</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://stackoverflow.com/questions/61266084/can-we-neatly-align-the-regression-equation-and-r2-and-p-value">Can we neatly align the regression equation and R2 and p value?</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://stackoverflow.com/questions/41205153/how-to-visulaize-linear-model-prediction-in-ggplot-along-with-confidence-interva">How to visulaize linear model prediction in ggplot along with confidence interval?</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span><a href="https://cran.r-project.org/web/packages/ggiraphExtra/vignettes/ggPredict.html">ggPredict-Visualize multiple regression model</a><a href="#fnref:5" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ggplot2</tag>
      
      <tag>R</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>高德地图获取天津道路交通态势</title>
    <link href="/2016/12/23/%E4%BA%A4%E9%80%9A%E6%80%81%E5%8A%BF/"/>
    <url>/2016/12/23/%E4%BA%A4%E9%80%9A%E6%80%81%E5%8A%BF/</url>
    
    <content type="html"><![CDATA[<blockquote><p>道路状态</p></blockquote><span id="more"></span><h2 id="获取矩形区域内道路交通状态"><a href="#获取矩形区域内道路交通状态" class="headerlink" title="获取矩形区域内道路交通状态"></a>获取矩形区域内道路交通状态</h2><p>详细说明请阅读官方说明文档<a href="https://lbs.amap.com/api/webservice/guide/api/trafficstatus">交通态势</a></p><h3 id="范围经纬度"><a href="#范围经纬度" class="headerlink" title="范围经纬度"></a>范围经纬度</h3><p>矩形范围需要用高德坐标描述，通过<code>JS API</code>的<a href="https://developer.amap.com/demo/javascript-api/example/map/click-to-get-lnglat">获取鼠标点击经纬度</a>功能得到左下及右上坐标。<br><strong>注意：矩形对角线不能超过10公里</strong></p><h3 id="请求说明"><a href="#请求说明" class="headerlink" title="请求说明"></a>请求说明</h3><p>请求如下：<br><a href="https://restapi.amap.com/v3/traffic/status/rectangle?rectangle=117.670834,38.919082;117.733319,38.988499&amp;extensions=all&amp;levels=1&amp;key=xxxxxxx">https://restapi.amap.com/v3/traffic/status/rectangle?rectangle=117.670834,38.919082;117.733319,38.988499&amp;extensions=all&amp;levels=1&amp;key=xxxxxxx</a></p><ul><li>其中<code>rectangle</code>为矩形区域范围，对角坐标用<code>;</code>隔开</li><li><code>levels</code>指定道路等级，下面各值代表的含义：<div class="code-wrapper"><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">1：高速（京藏高速）2：城市快速路、国道(西三环、103国道)3：高速辅路（G6辅路）4：主要道路（长安街、三环辅路路）5：一般道路（彩和坊路）6：无名道路<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li><li><code>key</code>需要自己注册申请<br>  <strong>说明：交通态势接口计划将于2020年12月31日下线，目前不再对新用户开放。如需合作请通过</strong><a href="https://console.amap.com/dev/ticket/type/others"><strong>工单</strong></a><strong>进行商务咨询。</strong></li><li>返回结果为<code>json</code>格式</li></ul><h3 id="结果存储"><a href="#结果存储" class="headerlink" title="结果存储"></a>结果存储</h3><p>环境：<code>R</code>，<code>Rstudio</code><br>Library：<code>curl</code></p><ol><li><p>受矩形范围限定，需要将目标区域分割成多块矩形，分别进行获取。创建<code>tjarea.csv</code>文件保存每块区域的请求地址。每个地址一行，无需表头。</p></li><li><p>建立<code>tj_traffic.r</code>脚本，每10分钟一次请求，保存json文件到本地</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">library<span class="token punctuation">(</span>curl<span class="token punctuation">)</span>  setwd<span class="token punctuation">(</span><span class="token string">"E:/"</span><span class="token punctuation">)</span>  Url <span class="token operator">=</span> read.csv<span class="token punctuation">(</span><span class="token string">"E:/TRAFFIC/tjarea.csv"</span><span class="token punctuation">,</span>header <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>  mytime <span class="token operator">=</span> Sys.time<span class="token punctuation">(</span><span class="token punctuation">)</span>  mydate <span class="token operator">=</span> format<span class="token punctuation">(</span>mytime<span class="token punctuation">,</span><span class="token string">"%Y%m%d"</span><span class="token punctuation">)</span>  dir.create<span class="token punctuation">(</span>mydate<span class="token punctuation">)</span>  nowhour <span class="token operator">=</span> substr<span class="token punctuation">(</span>as.character<span class="token punctuation">(</span>Sys.time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span>  nowmin <span class="token operator">=</span> substr<span class="token punctuation">(</span>as.character<span class="token punctuation">(</span>Sys.time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>  min <span class="token operator">=</span>     switch <span class="token punctuation">(</span>as.numeric<span class="token punctuation">(</span>nowmin<span class="token punctuation">)</span><span class="token percent-operator operator">%/%</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>    <span class="token string">"00"</span><span class="token punctuation">,</span>           <span class="token string">"10"</span><span class="token punctuation">,</span>    <span class="token string">"20"</span><span class="token punctuation">,</span>    <span class="token string">"30"</span><span class="token punctuation">,</span>    <span class="token string">"40"</span><span class="token punctuation">,</span>    <span class="token string">"50"</span>  <span class="token punctuation">)</span>    dir.create<span class="token punctuation">(</span>paste<span class="token punctuation">(</span>mydate<span class="token punctuation">,</span><span class="token string">"/"</span><span class="token punctuation">,</span>nowhour<span class="token punctuation">,</span>min<span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> collapse <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    tempdir <span class="token operator">=</span> paste<span class="token punctuation">(</span>mydate<span class="token punctuation">,</span><span class="token string">"/"</span><span class="token punctuation">,</span>nowhour<span class="token punctuation">,</span>min<span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> collapse <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">315</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    url <span class="token operator">=</span> as.character<span class="token punctuation">(</span>Url<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    dir <span class="token operator">=</span> paste<span class="token punctuation">(</span><span class="token string">"E:/TRAFFIC/TJTRAFFIC/"</span><span class="token punctuation">,</span>tempdir<span class="token punctuation">,</span><span class="token string">"/tj_"</span><span class="token punctuation">,</span> as.character<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">".json"</span><span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> collapse <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    curl_download<span class="token punctuation">(</span>url<span class="token punctuation">,</span> dir<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></li><li><p>建立<code>bat</code>文件，用于设置Windows定时任务。</p><div class="code-wrapper"><pre class="line-numbers language-batch" data-language="batch"><code class="language-batch"><span class="token command"><span class="token keyword">Rscript</span> <span class="token parameter attr-name">-e</span> <span class="token string">"source(\"E:/TJTRAFFIC/tj_traffic.R/"</span>,encoding = 'UTF<span class="token number">-8</span>'</span><span class="token punctuation">)</span>"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li></ol><h3 id="Json解析"><a href="#Json解析" class="headerlink" title="Json解析"></a>Json解析</h3><p>Library：<code>rjson</code>,<code>xlsx</code><br>解析json文件中的roadinfo，其中包含多条道路数据，用rbind拼接并添加timestamp，添加路名与描述组成的唯一字段，每小时输出一个文件xlsx</p><div class="code-wrapper"><pre class="line-numbers language-r" data-language="r"><code class="language-r">Sys.setenv<span class="token punctuation">(</span>JAVA_HOME<span class="token operator">=</span><span class="token string">"C:/Program Files/Java/jre1.8.0\_111"</span><span class="token punctuation">)</span>   library<span class="token punctuation">(</span>rjson<span class="token punctuation">)</span>  library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span>  library<span class="token punctuation">(</span>xlsx<span class="token punctuation">)</span>  <span class="token comment"># 设置工作目录  </span>setwd<span class="token punctuation">(</span><span class="token string">"E:/TJTRAFFIC/"</span><span class="token punctuation">)</span> <span class="token comment"># 读取模板</span>roadtraffic <span class="token operator">=</span> readRDS<span class="token punctuation">(</span><span class="token string">"roadtraffic.rds"</span><span class="token punctuation">)</span>  <span class="token comment">#日期循环</span><span class="token keyword">for</span> <span class="token punctuation">(</span>date <span class="token keyword">in</span> <span class="token number">20161122</span><span class="token operator">:</span><span class="token number">20161123</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>hour <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>k <span class="token keyword">in</span> <span class="token number">0</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">195</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            tryCatch<span class="token punctuation">(</span><span class="token punctuation">&#123;</span>              result <span class="token operator">=</span> fromJSON<span class="token punctuation">(</span>file <span class="token operator">=</span> paste<span class="token punctuation">(</span>                date<span class="token punctuation">,</span><span class="token string">"/"</span><span class="token punctuation">,</span>formatC<span class="token punctuation">(</span>hour<span class="token punctuation">,</span>width <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>flag <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>k<span class="token punctuation">,</span><span class="token string">"0/tj\_"</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token string">".json"</span><span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> collapse <span class="token operator">=</span> <span class="token keyword">NULL</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token operator">$</span>status <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                roads <span class="token operator">=</span> result<span class="token operator">$</span>trafficinfo<span class="token operator">$</span>roads                temp <span class="token operator">=</span> do.call<span class="token punctuation">(</span>rbind<span class="token punctuation">,</span>roads<span class="token punctuation">)</span>                temp <span class="token operator">=</span> as.data.frame<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>                strtime <span class="token operator">=</span> paste<span class="token punctuation">(</span>                  date<span class="token punctuation">,</span>formatC<span class="token punctuation">(</span>hour<span class="token punctuation">,</span>width <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>flag <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>k<span class="token punctuation">,</span><span class="token string">"000"</span><span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> collapse <span class="token operator">=</span> <span class="token keyword">NULL</span>                <span class="token punctuation">)</span>                temp <span class="token operator">=</span> mutate<span class="token punctuation">(</span>temp<span class="token punctuation">,</span>timestamp <span class="token operator">=</span> strtime<span class="token punctuation">)</span>                roadtraffic <span class="token operator">=</span> rbind.data.frame<span class="token punctuation">(</span>roadtraffic<span class="token punctuation">,</span>temp<span class="token punctuation">)</span>              <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>              <span class="token punctuation">,</span>error<span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token keyword">NULL</span>             <span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>      roadtraffic <span class="token operator">=</span> mutate<span class="token punctuation">(</span>roadtraffic<span class="token punctuation">,</span> fullname <span class="token operator">=</span> paste<span class="token punctuation">(</span>name<span class="token punctuation">,</span>direction<span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> collapse <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      write.xlsx2<span class="token punctuation">(</span>roadtraffic<span class="token punctuation">,</span>paste<span class="token punctuation">(</span><span class="token string">"excel/"</span><span class="token punctuation">,</span>date<span class="token punctuation">,</span>formatC<span class="token punctuation">(</span>hour<span class="token punctuation">,</span>width <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>flag <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">".xlsx"</span><span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> collapse <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> row.name <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>      roadtraffic <span class="token operator">=</span> readRDS<span class="token punctuation">(</span><span class="token string">"roadtraffic.rds"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>高德API</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ArcGIS 路网网格划分</title>
    <link href="/2016/10/17/ArcGIS-%E8%B7%AF%E7%BD%91%E5%88%87%E5%88%86/"/>
    <url>/2016/10/17/ArcGIS-%E8%B7%AF%E7%BD%91%E5%88%87%E5%88%86/</url>
    
    <content type="html"><![CDATA[<p>在已有网格的情况下，用网格将道路切断，以便建立道路和网格的对应关系。</p><span id="more"></span><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>现有北京<a href="https://mattzou.com/2016/02/28/ArcGIS-Fishnet/#">网格图层（线要素）</a>以及北京<strong>路网图层</strong>，要用网格线切分道路。</p><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>将网格图层中的全部要素复制到路网图层，选用<code> Planarize Lines</code>工具，将相交线打断，完成切分后通过要素筛选，将参与切分的网格线删除，剩下的路网就是切分好的了，接着通过<a href="https://mattzou.com/2016/03/03/ArcGIS-%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84/#">要素映射</a>建立道路与网格的映射关系，道路网格划分就完成了。 </p><h3 id="工具位置"><a href="#工具位置" class="headerlink" title="工具位置"></a>工具位置</h3><p>图层进入编辑状态后，<strong>Advanced Editing</strong> 工具栏上，点击即运行。</p><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ArcGIS/%E8%B7%AF%E7%BD%91%E5%88%87%E5%88%861.jpg/pic" alt="路网切分 1"> </p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>1.在<strong>路网图层</strong>上<a href="http://resources.arcgis.com/zh-cn/help/main/10.2/index.html#/na/01m60000005p000000/">启动编辑</a>;</p><p>2.<a href="resources.arcgis.com/zh-cn/help/main/10.2/index.html#/na/00s50000000w000000/">全选</a><strong>网格图层</strong>要素，<code> Ctrl + C</code> ，然后<code>Ctrl + V</code> 到<strong>路网图层</strong>;</p><p>3.在合并生成的新路网图层中全选要素，在<strong>Advanced Editing</strong> 工具栏上点击<a href="http://resources.arcgis.com/en/help/main/10.2/index.html#//01m800000012000000/">Planarize Lines</a>工具；</p><p>4.打开切分完成后的图层属性表，通过网格图层特有属性，用<a href="http://resources.arcgis.com/zh-cn/help/main/10.2/index.html#/na/00s500000021000000/">按属性选择</a>方法，将网格线要素选出，并删除，剩下的就是切分好的路网；</p><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><blockquote><p>道路均在网格线处被截断：</p></blockquote><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ArcGIS/%E8%B7%AF%E7%BD%91%E5%88%87%E5%88%862.jpg/pic" alt="路网切分 2"></p><hr>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ArcGIS</tag>
      
      <tag>路网切分</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>“公益云图”数据可视化创新大赛技术汇总</title>
    <link href="/2016/09/26/%E2%80%9C%E5%85%AC%E7%9B%8A%E4%BA%91%E5%9B%BE%E2%80%9D%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/"/>
    <url>/2016/09/26/%E2%80%9C%E5%85%AC%E7%9B%8A%E4%BA%91%E5%9B%BE%E2%80%9D%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>本篇用以总结参赛以来各种技术实现及思路。</p><blockquote><p>别管对手是否强大，动手去做，说不定有奇迹呢！</p></blockquote><span id="more"></span><hr><h1 id="作品简介"><a href="#作品简介" class="headerlink" title="作品简介"></a>作品简介</h1><br><div class="row">    <embed src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/Environment/MagicGraph.pdf" width="100%" height="550" type="application/pdf"></div><br><h1 id="Try-it-offline"><a href="#Try-it-offline" class="headerlink" title="Try it! (offline)"></a>Try it! (offline)</h1><p><a href="http://mattzou.com/MG/">MagicGraph</a></p><h1 id="参赛思考"><a href="#参赛思考" class="headerlink" title="参赛思考"></a>参赛思考</h1><h2 id="队伍"><a href="#队伍" class="headerlink" title="队伍"></a>队伍</h2><p>队伍名称纠结了我半天，想想用<code>R</code>这么学术的软件做可视化交互，必是要折腾一番，本着内心小小的<code>Geeker</code>精神，外加英文代号<code>Matt</code>，就这么凑了个<em>MGeek</em>.</p><h2 id="赛题"><a href="#赛题" class="headerlink" title="赛题"></a>赛题</h2><p>选了个跟自己专业对口的，哈！</p><blockquote><p><strong>空气质量与大气环境</strong></p></blockquote><h3 id="涉及数据"><a href="#涉及数据" class="headerlink" title="涉及数据"></a>涉及数据</h3><ul><li>区域内空气质量的实时监测数据，以及监测点的地理坐标;</li><li>当地气象局提供的气压、温度、湿度、降水与风力风向等数据，以及信息采集点的地理坐标;</li></ul><h3 id="呈现内容"><a href="#呈现内容" class="headerlink" title="呈现内容"></a>呈现内容</h3><p><strong>空气质量与大气环境的关系</strong><br>    以时间流逝的方式，动态展现区域内空气质量变化。比如在地图图层上，以颜色表示空气质量、以箭头方向和粗细表示风力风向、以观测点位置的动态图标表示温度和湿度等;</p><p><strong>空气污染梯度和区域污染估计</strong><br>    通过曲线拟合，在地图上，绘制类似等高线型的空气污染梯度图，对没有空气质量监测的城市和地区进行空气质量估计;</p><p><strong>风和降水对空气污染的帮助</strong><br>    通常由于风和降水的作用，可以显著改善空气质量。通过关联分析，定量的了解给定风力或降水条件下，空气质量会得到多大程度改善，空气质量改善的速度是什么样的;</p><p><strong>推断空气污染物来源（高级内容）</strong><br>    通过污染物扩散趋势和梯度，推断污染源发生的地理位置，并在地图上标识;</p><p><strong>拟合空气污染与大气环境方程（高级内容）</strong><br>    拟合空气污染物扩散的方程，制作交互式的污染物扩散预测，通过用户输入可改变某地的气象状况，然后动态模拟在设定的空气状况下，污染物扩散的趋势、范围和速度。</p><h2 id="作品"><a href="#作品" class="headerlink" title="作品"></a>作品</h2><h3 id="使用数据"><a href="#使用数据" class="headerlink" title="使用数据"></a>使用数据</h3><ul><li>全国县级城市实时天气数据</li><li>全国风场格点实况数据</li><li>国控站点监测实时空气污染数据</li><li>国控空气检测站点分布数据</li><li>南京市道路卡口车辆监测数据</li><li>近期Global Forecast System (GFS)数据 United States’ National Weather Service (NWS)获取</li></ul><h3 id="作品设计思路"><a href="#作品设计思路" class="headerlink" title="作品设计思路"></a>作品设计思路</h3><ul><li>污染源排放污染物后随大气活动在环境中扩散，跟踪大气运动轨迹，提供了一个溯流而上的方式。</li><li>因此现有空气质量监测与大气环境观测体系所提供的数据不仅可以分析污染有多重，还可以通过关联分析推断污染源的位置。</li><li>结合环境数据、地图位置信息，分析污染来源。</li></ul><h3 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h3><h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><ul><li>数据处理<br>  <em>R、MATLAB、Excel、ArcGIS</em></li><li>图像处理<br>  <em>Adobe Photoshop</em></li><li>服务组件<br>  <em>Docker、Shiny server、Node.js</em></li><li>部署<br>  <em>阿里云ECS</em></li></ul><h4 id="创作方法"><a href="#创作方法" class="headerlink" title="创作方法"></a>创作方法</h4><ol><li>展示数据获取及处理</li><li>R 数据处理</li><li>Rmarkdown编写展示文档，基于以下组件：<br><a href="http://rmarkdown.rstudio.com/">R Markdown</a>、<a href="http://rmarkdown.rstudio.com/flexdashboard/">flexdashboard</a>、<a href="http://ggplot2.org/">ggplot2</a>、<a href="https://plot.ly/r/">Plotly For R</a>、<a href="http://jkunst.com/highcharter/">Highcharter</a>、<a href="http://rstudio.github.io/leaflet/">Leaflet For R</a></li><li>动态风场图基于<a href="https://github.com/dannycochran/windable">windable</a>项目</li><li><a href="https://www.rstudio.com/products/shiny/shiny-server/">Shiny server</a>作为Web server，动态编译R markdown文件生成交互页面</li><li><a href="https://hub.docker.com/r/quantumobject/docker-shiny/">Docker</a>打包以上组件，部署到阿里云ECS</li></ol><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><blockquote><ol><li> <a href="http://mattzou.github.io/2016/02/28/ArcGIS_Fishnet_2016-02-28/#">[R可视化工具]</a> <strong>可视化</strong> 工具汇总</li><li> <a href="http://mattzou.github.io/2016/03/03/ArcGIS_%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84_2016-03-03/#">[Plotly]</a> <strong>可视化</strong> <code>Plotly For R</code> </li><li> <a href="http://mattzou.github.io/2016/03/03/ArcGIS_%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84_2016-03-03/#">[R markdown]</a> <strong>可视化</strong> <code>R markdown</code> </li><li> <a href="http://mattzou.github.io/2016/03/03/ArcGIS_%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84_2016-03-03/#">[Flexdashboard]</a> <strong>可视化</strong> <code>Flexdashboard</code> </li><li> <a href="http://mattzou.github.io/2016/03/03/ArcGIS_%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84_2016-03-03/#">[Plotly]</a> <strong>可视化</strong> <code>Plotly For R</code> </li><li> <a href="http://mattzou.github.io/2016/03/03/ArcGIS_%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84_2016-03-03/#">[Shiny server]</a> <strong>可视化</strong> <code>Shiny server</code> </li><li> <a href="http://mattzou.github.io/2016/03/03/ArcGIS_%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84_2016-03-03/#">[Leaflet]</a> <strong>可视化</strong> <code>Plotly For R</code> </li><li> <a href="http://mattzou.github.io/2016/03/03/ArcGIS_%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84_2016-03-03/#">[Highcharter]</a> <strong>可视化</strong> <code>Plotly For R</code> </li><li> <a href="http://mattzou.github.io/2016/03/03/ArcGIS_%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84_2016-03-03/#">[Docker]</a> <strong>可视化</strong> <code>Plotly For R</code> </li></ol></blockquote>]]></content>
    
    
    <categories>
      
      <category>目录</category>
      
    </categories>
    
    
    <tags>
      
      <tag>天池</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracle impdp与expdp进行数据资产快速迁移</title>
    <link href="/2016/08/14/Oracle-impdp%E4%B8%8Eexpdp/"/>
    <url>/2016/08/14/Oracle-impdp%E4%B8%8Eexpdp/</url>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>对于Oracle数据迁移任务，官方提供了一系列工具<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="Oralce Utilities">[1]</span></a></sup>，应用较多的是<strong>Data Pump</strong>工具和<a href="https://mattzou.com/2016/03/18/Oracle_SQLLDR/"><strong>SQL*Loader工具</strong></a>。</p><p><strong>Data Pump</strong>工具主要适用于Oracle数据库之间数据迁移，<strong>SQL*Loader工具</strong>偏向于外部数据文件导入。</p><blockquote><ul><li>Oracle Data Pump technology enables very high-speed movement of data and metadata from one database to another.</li><li>SQL*Loader loads data from external files into Oracle Database tables.<br>© Oracle 说的😎</li></ul></blockquote><p><strong>Data Pump</strong>工具由以下三个模块组成：</p><blockquote><ol><li>Command-line clients, <code>expdp</code> and <code>impdp</code></li><li>DBMS_DATAPUMP PL/SQL package (also known as the Data Pump API)</li><li>DBMS_METADATA PL/SQL package (also known as the Metadata API)</li></ol></blockquote><p>本文主要介绍<code>expdp</code> 和 <code>impdp</code> 的使用方法。</p><h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><p>环境： Windows 10 or latest， Oracle 11g or latest version</p><h3 id="目录创建与授权"><a href="#目录创建与授权" class="headerlink" title="目录创建与授权"></a>目录创建与授权</h3><p><strong>Data Pump</strong>工具导入导出的文件需要储存在实体目录下，并在Oracle中创建虚拟目录名称与之映射。</p><h4 id="目录查询"><a href="#目录查询" class="headerlink" title="目录查询"></a>目录查询</h4><p>以管理员账号登陆<strong>sqlplus</strong></p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span>conn system<span class="token operator">/</span>manger<span class="token variable">@orcl</span> <span class="token keyword">as</span> sysdba<span class="token keyword">SQL</span><span class="token operator">></span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_directories<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div><p>可以查看当前存在的目录，结果如下：</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">OWNER                          DIRECTORY_NAME<span class="token comment">------------------------------ -----------------------------</span>DIRECTORY_PATH<span class="token comment">------------------------------------------------------------</span>SYS                            XMLDIRc:\ade\aime_dadvfh0169\oracle<span class="token operator">/</span>rdbms<span class="token operator">/</span>xml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p><code>DIRECTORY_PATH</code>是实体目录位置，请确保已经创建此目录<br><code>DIRECTORY_NAME</code>是虚拟目录名称</p><h4 id="目录创建"><a href="#目录创建" class="headerlink" title="目录创建"></a>目录创建</h4><p>可以使用已经存在的目录，或者创建新的目录(推荐)</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span><span class="token keyword">create</span> directory dump_dir <span class="token keyword">as</span> <span class="token string">'d:\test\dump'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><p><code>dump_dir</code>自定义名称，对应<code>DIRECTORY_NAME</code><br>创建后可以再次<a href="#%E7%9B%AE%E5%BD%95%E6%9F%A5%E8%AF%A2">查询</a>是否创建成功。</p><h4 id="目录授权"><a href="#目录授权" class="headerlink" title="目录授权"></a>目录授权</h4><p>给数据恢复或导出用户授权<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="Required Roles for Oracle Data Pump Export and Import Operations">[2]</span></a></sup></p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span><span class="token keyword">grant</span> <span class="token keyword">read</span><span class="token punctuation">,</span><span class="token keyword">write</span> <span class="token keyword">on</span> directory dump_dir <span class="token keyword">to</span> scott<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><h3 id="导入与导出"><a href="#导入与导出" class="headerlink" title="导入与导出"></a>导入与导出</h3><h4 id="expdp导出"><a href="#expdp导出" class="headerlink" title="expdp导出"></a>expdp导出</h4><p>导出生成的dmp会保存在上面创建的实体目录中。</p><ol><li><p>导出用户</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">expdp scott<span class="token operator">/</span>tiger<span class="token variable">@orcl</span> schemas<span class="token operator">=</span>scott <span class="token keyword">dumpfile</span><span class="token operator">=</span>expdp<span class="token punctuation">.</span>dmp directory<span class="token operator">=</span>dump_dir<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li><li><p>导出表</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">expdp scott<span class="token operator">/</span>tiger<span class="token variable">@orcl</span> <span class="token keyword">tables</span><span class="token operator">=</span>emp<span class="token punctuation">,</span>dept <span class="token keyword">dumpfile</span><span class="token operator">=</span>expdp<span class="token punctuation">.</span>dmp directory<span class="token operator">=</span>dump_dir<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li><li><p>按查询条件导</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">expdp scott<span class="token operator">/</span>tiger<span class="token variable">@orcl</span> directory<span class="token operator">=</span>dump_dir <span class="token keyword">dumpfile</span><span class="token operator">=</span>expdp<span class="token punctuation">.</span>dmp <span class="token keyword">tables</span><span class="token operator">=</span>emp query<span class="token operator">=</span><span class="token string">'where deptno=20'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li><li><p>按表空间导</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">expdp system<span class="token operator">/</span>manager<span class="token variable">@orcl</span> directory<span class="token operator">=</span>dump_dir <span class="token keyword">dumpfile</span><span class="token operator">=</span><span class="token keyword">tablespace</span><span class="token punctuation">.</span>dmp tablespaces<span class="token operator">=</span><span class="token keyword">temp</span><span class="token punctuation">,</span>example<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li><li><p>导整个数据库</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">expdp system<span class="token operator">/</span>manager<span class="token variable">@orcl</span> directory<span class="token operator">=</span>dump_dir <span class="token keyword">dumpfile</span><span class="token operator">=</span><span class="token keyword">full</span><span class="token punctuation">.</span>dmp <span class="token keyword">full</span><span class="token operator">=</span>y<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li></ol><h4 id="impdp导入"><a href="#impdp导入" class="headerlink" title="impdp导入"></a>impdp导入</h4><p>导入之前，需要确保<a href="#%E7%9B%AE%E5%BD%95%E5%88%9B%E5%BB%BA%E4%B8%8E%E6%8E%88%E6%9D%83">目录创建与授权</a>完成，并且dmp文件已经拷贝至对应目录下。</p><ol><li><p>导入用户（从用户scott导入到用户scott）</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">impdp scott<span class="token operator">/</span>tiger<span class="token variable">@orcl</span> directory<span class="token operator">=</span>dump_dir <span class="token keyword">dumpfile</span><span class="token operator">=</span>expdp<span class="token punctuation">.</span>dmp schemas<span class="token operator">=</span>scott<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li><li><p>导入表（从scott用户中把表dept和emp导入到system用户中）</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">impdp system<span class="token operator">/</span>manager<span class="token variable">@orcl</span> directory<span class="token operator">=</span>dump_dir <span class="token keyword">dumpfile</span><span class="token operator">=</span>expdp<span class="token punctuation">.</span>dmp <span class="token keyword">tables</span><span class="token operator">=</span>scott<span class="token punctuation">.</span>dept<span class="token punctuation">,</span>scott<span class="token punctuation">.</span>emp remap_schema<span class="token operator">=</span>scott:system<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li><li><p>导入表空间</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">impdp system<span class="token operator">/</span>manager<span class="token variable">@orcl</span> directory<span class="token operator">=</span>dump_dir <span class="token keyword">dumpfile</span><span class="token operator">=</span><span class="token keyword">tablespace</span><span class="token punctuation">.</span>dmp tablespaces<span class="token operator">=</span>example<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li><li><p>导入数据库</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">impdb system<span class="token operator">/</span>manager<span class="token variable">@orcl</span> directory<span class="token operator">=</span>dump_dir <span class="token keyword">dumpfile</span><span class="token operator">=</span><span class="token keyword">full</span><span class="token punctuation">.</span>dmp <span class="token keyword">full</span><span class="token operator">=</span>y<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li><li><p>追加数据</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">impdp system<span class="token operator">/</span>manager<span class="token variable">@orcl</span> directory<span class="token operator">=</span>dump_dir <span class="token keyword">dumpfile</span><span class="token operator">=</span>expdp<span class="token punctuation">.</span>dmp schemas<span class="token operator">=</span>system table_exists_action<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li></ol><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol><li>expdp和impdp是服务端工具程序，只能在oracle服务端使用，不能在客户端使用<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="ORACLE使用EXPDP和IMPDP数据泵进行导出导入的方法">[3]</span></a></sup>。</li><li>imp/exp命令与impdp/expdp工具产生的文件不通用，请勿混淆<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="Oracle Data Pump (expdp, impdp) in Oracle Database 10g, 11g, 12c, 18c, 19c">[4]</span></a></sup>。</li></ol><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sutil/">Oralce Utilities</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/sutil/oracle-data-pump-overview.html#GUID-8B6975D3-3BEC-4584-B416-280125EEC57E">Required Roles for Oracle Data Pump Export and Import Operations</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="http://blog.sina.com.cn/s/blog_67d41beb0100ixnb.html">ORACLE使用EXPDP和IMPDP数据泵进行导出导入的方法</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://oracle-base.com/articles/10g/oracle-data-pump-10g">Oracle Data Pump (expdp, impdp) in Oracle Database 10g, 11g, 12c, 18c, 19c</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
      <tag>Oracle Utilities</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ORA-xxxxx</title>
    <link href="/2016/08/14/ORA-xxxxx/"/>
    <url>/2016/08/14/ORA-xxxxx/</url>
    
    <content type="html"><![CDATA[<h2 id="ORA-01659-无法分配超出-7-的-MINEXTENTS"><a href="#ORA-01659-无法分配超出-7-的-MINEXTENTS" class="headerlink" title="ORA-01659: 无法分配超出 7 的 MINEXTENTS"></a>ORA-01659: 无法分配超出 7 的 MINEXTENTS</h2><p>主要原因是表空间不够,将其设置为自动扩展即可。</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">database</span> datafile <span class="token string">'D:/app/Administrator/oradata/user_data.dbf'</span> autoextend <span class="token keyword">on</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div><p>或者可以在创建perfstat表空间的时候进行设置：</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">tablespace</span> perfstatdatafile <span class="token string">'D:/app/Administrator/oradata/user_data.dbf'</span> size <span class="token number">100</span>m autoextend <span class="token keyword">on</span>extend management <span class="token keyword">local</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><blockquote><p>更多内容可见<a href="http://localhost:4758/2016/03/15/Oracle_%E8%A1%A8%E7%A9%BA%E9%97%B4/">Oracle 表空间管理</a></p></blockquote><h2 id="ORA-32773-不支持对小文件表空间-TEST-的操作"><a href="#ORA-32773-不支持对小文件表空间-TEST-的操作" class="headerlink" title="ORA-32773: 不支持对小文件表空间 TEST 的操作"></a>ORA-32773: 不支持对小文件表空间 TEST 的操作</h2><p>需要扩展表空间</p><ol><li>增加数据文件</li><li>增加数据文件的大小</li><li>设定数据文件自动增长</li></ol><blockquote><p>更多内容可见<a href="http://localhost:4758/2016/03/15/Oracle_%E8%A1%A8%E7%A9%BA%E9%97%B4/">Oracle 表空间管理</a></p></blockquote><h2 id="ORA-01830-日期格式图片在转换整个输入字符串之前结束"><a href="#ORA-01830-日期格式图片在转换整个输入字符串之前结束" class="headerlink" title="ORA-01830: 日期格式图片在转换整个输入字符串之前结束"></a>ORA-01830: 日期格式图片在转换整个输入字符串之前结束</h2><p><code>to_date</code>比较的时候报这个错误<br>问题：<strong>varchar2</strong>类型转换成<strong>date</strong>类型</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> to_date<span class="token punctuation">(</span>INVOICE_DATE<span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tab<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><p>最后查的原因：INVOICE_DATE=‘2005-11-10 00:00:00’的长度大于格式化’yyyy-mm-dd’的长度<br>解决：使用substr()</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">to_date<span class="token punctuation">(</span>substr<span class="token punctuation">(</span>INVOICE_DATE<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><h2 id="ORA-01810：格式代码出现两次"><a href="#ORA-01810：格式代码出现两次" class="headerlink" title="ORA-01810：格式代码出现两次"></a>ORA-01810：格式代码出现两次</h2><ol><li>Oracle中使用to_date()时格式化日期需要注意格式码，如：<div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">'2005-01-01 13:14:20'</span><span class="token punctuation">,</span><span class="token string">'yyyy-MM-dd HH24:mm:ss'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div>原因是SQL中不区分大小写，MM和mm被认为是相同的格式代码，所以Oracle的SQL采用了mi代替分钟。<div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> to_date<span class="token punctuation">(</span><span class="token string">'2005-01-01 13:14:20'</span><span class="token punctuation">,</span><span class="token string">'yyyy-MM-dd HH24:mi:ss'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li><li>另要以24小时的形式显示出来要用HH24<div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> to_char<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'yyyy-MM-dd HH24:mi:ss'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span class="token comment">//mi是分钟</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></li></ol><h2 id="ORA-00059-超出-DB-FILES-的最大值"><a href="#ORA-00059-超出-DB-FILES-的最大值" class="headerlink" title="ORA-00059: 超出 DB_FILES 的最大值"></a>ORA-00059: 超出 DB_FILES 的最大值</h2><p><code>init parameters</code>里的db_files空间不足</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> parameter db_files<span class="token punctuation">;</span><span class="token keyword">alter</span> system <span class="token keyword">set</span> db_files<span class="token operator">=</span>xxMB scope<span class="token operator">=</span>spfile<span class="token punctuation">;</span><span class="token keyword">shutdown</span> immediate<span class="token punctuation">;</span>startup<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracle SQL*Loader 应用</title>
    <link href="/2016/03/18/Oracle-SQLLDR/"/>
    <url>/2016/03/18/Oracle-SQLLDR/</url>
    
    <content type="html"><![CDATA[<blockquote><p>来了一大批单个大小动辄7G的文本文件，导入数据表中，怎么办!!!!尝试用<code>PL/SQL Developer</code>中的文本导入器，结果====<strong>卡死</strong>=====很久之后====<strong>卡死</strong></p></blockquote><span id="more"></span><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>Oracle常用的表数据迁移方法有以下几种：</p><ol><li><p>A表导出包含 <code>insert</code> 的sql，逐条插入B表中</p></li><li><p>建立数据库间的 dblink，然后用 <code>create table B as select * from A@dblink where </code>，或 <code>insert into B select * from A@dblink where </code></p></li><li><p><code>expdp</code> A 表，再 <code>impdp</code> 到 B 表</p></li><li><p>文本数据采用<strong>SQL*Loader</strong> (sqlldr) </p><p> 第1、2种方式可用以下方式优化导入效率：</p> <div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> B nologging<span class="token punctuation">;</span>  <span class="token keyword">insert</span> <span class="token comment">/* +APPEND */</span> <span class="token keyword">into</span> B<span class="token punctuation">(</span>col1<span class="token punctuation">,</span>col2<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>val1<span class="token punctuation">,</span>val2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">insert</span> <span class="token comment">/* +APPEND */</span> <span class="token keyword">into</span> B <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> A<span class="token variable">@dblink</span> <span class="token keyword">where</span>  <span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2></li><li><p><strong>SQL*Loader</strong> 使用过程中需要创建一个控制文件<code>.ctl</code>，示例如下：</p></li></ol>  <div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">OPTIONS <span class="token punctuation">(</span><span class="token keyword">rows</span><span class="token operator">=</span><span class="token number">100000</span><span class="token punctuation">)</span>  <span class="token comment">/*定义sqlldr部分参数*/</span><span class="token keyword">load</span> <span class="token keyword">data</span><span class="token keyword">infile</span><span class="token string">'F:\2014-10-31.txt'</span><span class="token comment">/*指定数据文件*/</span><span class="token keyword">insert</span><span class="token comment">/*在操作类型 insert 位置可选一下值：1) insert   --为缺省方式，在数据装载开始时要求表为空2) append   --在表中追加新记录3) replace  --删除旧记录(用 delete from table 语句)，替换成新装载的记录4) truncate --删除旧记录(用 truncate table 语句)，替换成新装载的记录*/</span><span class="token keyword">into</span> <span class="token keyword">table</span> user_table<span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span><span class="token comment">/*指定字段分隔符*/</span><span class="token keyword">Optionally</span> <span class="token keyword">enclosed</span> <span class="token keyword">by</span> <span class="token string">'"'</span> <span class="token comment">/*可选。 数据中每个字段用 '"' 框起，如果字段中有 "," 分隔符，可避免将字段截断*/</span><span class="token punctuation">(</span>PLATE<span class="token punctuation">,</span>ACROSS_TIME <span class="token keyword">DATE</span><span class="token string">"YYYY-MM-DD HH24:MI:SS"</span><span class="token punctuation">,</span>  <span class="token comment">/*指定接受日期的格式，相当用 to_date() 函数转换*/</span>VEH_SPD NUMBER<span class="token comment">/*字段指定类型，默认是 CHARACTER 类型*/</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><ol start="2"><li>然后再执行<code>sqlldr</code>命令，</li></ol><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">sqlldr userid<span class="token variable">@service</span> control<span class="token operator">=</span><span class="token keyword">user</span><span class="token punctuation">.</span>ctl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div><p> 命令包含以下<strong>关键字</strong>：</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">    userid <span class="token comment">-- ORACLE 用户名/口令</span>   control <span class="token comment">-- 控制文件名</span>       log <span class="token comment">-- 日志文件名</span>       bad <span class="token comment">-- 错误文件名</span>      <span class="token keyword">data</span> <span class="token comment">-- 数据文件名</span>   <span class="token keyword">discard</span> <span class="token comment">-- 废弃文件名</span>discardmax <span class="token comment">-- 允许废弃的文件的数目         (全部默认)</span>      skip <span class="token comment">-- 要跳过的逻辑记录的数目  (默认 0)</span>      <span class="token keyword">load</span> <span class="token comment">-- 要加载的逻辑记录的数目  (全部默认)</span>    <span class="token keyword">errors</span> <span class="token comment">-- 允许的错误的数目         (默认 50)</span>      <span class="token keyword">rows</span> <span class="token comment">-- 常规路径绑定数组中或直接路径保存数据间的行数(默认: 常规路径 64, 所有直接路径)</span>  bindsize <span class="token comment">-- 常规路径绑定数组的大小 (以字节计)  (默认 256000)</span>    silent <span class="token comment">-- 运行过程中隐藏消息 (标题,反馈,错误,废弃,分区)</span>    direct <span class="token comment">-- 使用直接路径                     (默认 FALSE)</span>   parfile <span class="token comment">-- 参数文件: 包含参数说明的文件的名称</span>  parallel <span class="token comment">-- 执行并行加载                    (默认 FALSE)</span>      <span class="token keyword">file</span> <span class="token comment">-- 要从以下对象中分配区的文件</span>skip_unusable_indexes <span class="token comment">-- 不允许/允许使用无用的索引或索引分区  (默认 FALSE)</span>skip_index_maintenance <span class="token comment">-- 没有维护索引, 将受到影响的索引标记为无用  (默认 FALSE)</span>commit_discontinued <span class="token comment">-- 提交加载中断时已加载的行  (默认 FALSE)</span>  readsize <span class="token comment">-- 读取缓冲区的大小               (默认 1048576)</span>external_table <span class="token comment">-- 使用外部表进行加载; NOT_USED, GENERATE_ONLY, EXECUTE  (默认NOT_USED)</span>columnarrayrows <span class="token comment">-- 直接路径列数组的行数  (默认 5000)</span>streamsize <span class="token comment">-- 直接路径流缓冲区的大小 (以字节计)  (默认 256000)</span>multithreading <span class="token comment">-- 在直接路径中使用多线程</span> resumable <span class="token comment">-- 启用或禁用当前的可恢复会话  (默认 FALSE)</span>resumable_name <span class="token comment">-- 有助于标识可恢复语句的文本字符串</span>resumable_timeout <span class="token comment">-- RESUMABLE 的等待时间 (以秒计)  (默认 7200)</span>date_cache <span class="token comment">-- 日期转换高速缓存的大小 (以条目计)  (默认 1000)</span>no_index_errors <span class="token comment">-- 出现任何索引错误时中止加载  (默认 FALSE)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><blockquote><p>以上部分参数可以在控制文件中以<code>OPTIONS()</code>来定义</p></blockquote><h2 id="性能提升"><a href="#性能提升" class="headerlink" title="性能提升"></a>性能提升</h2><ol><li><strong>Direct</strong>导入可以跳过数据库的相关逻辑<code>(DIRECT=TRUE)</code>，而直接将数据导入到数据文件中，可以提高导入数据的性能。当然，在很多情况下，不能使用此参数(如果主键重复的话会使索引的状态变成<strong>UNUSABLE</strong>)</li><li>使用 <code>ROWS=n</code> 限定<code>commit</code>频率</li><li>使用并行载入，只在** Direct path loads<strong>模式下可用，这个选项可让</strong>SQL*Loader**同时执行多个任务。<div class="code-wrapper"><pre class="line-numbers language-plsql" data-language="plsql"><code class="language-plsql">sqlldr control<span class="token operator">=</span><span class="token keyword">first</span><span class="token punctuation">.</span>ctl  parallel<span class="token operator">=</span><span class="token boolean">true</span> direct<span class="token operator">=</span><span class="token boolean">true</span>sqlldr control<span class="token operator">=</span><span class="token keyword">second</span><span class="token punctuation">.</span>ctl parallel<span class="token operator">=</span><span class="token boolean">true</span> direct<span class="token operator">=</span><span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></li><li> 使用<code>unrecoverable</code>，此选项禁止<code>redo</code>日志的产生，只在** Direct path loads**模式可用。  </li></ol><ul><li>效果<br>  <img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/sql/sqlldr.JPG" alt="效果"></li></ul><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><a href="http://www.cnblogs.com/benio/archive/2011/10/14/2211171.html">SQL*Loader详解</a></li><li><a href="http://www.remote-dba.net/teas_rem_util18.htm">Maximizing SQL*Loader Performance</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
      <tag>Oracle Utilities</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracle 表空间管理</title>
    <link href="/2016/03/15/Oracle-%E8%A1%A8%E7%A9%BA%E9%97%B4/"/>
    <url>/2016/03/15/Oracle-%E8%A1%A8%E7%A9%BA%E9%97%B4/</url>
    
    <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>表空间用于组织管理实体数据文件</p><blockquote><p>Oracle stores data logically in tablespaces and physically in datafiles associated with the corresponding tablespace.<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="Tablespaces, Datafiles, and Control Files">[1]</span></a></sup></p></blockquote><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/sql/Datafiles%20and%20Tablespaces.gif/bg"></p><p>自Oracle 10g后，Oracle提供两类表空间<code>BigFile Tablespace，BFT</code>和<code>SmallFile Tablespace，SFT</code>，分别支持不同类型的<strong>datafiles</strong>，关于这两类表空间详细内容，可以参考此文<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="BigFile和SmallFile表空间技术">[2]</span></a></sup>。本文主要以<code>SmallFile Tablespace</code>类型表空间实现为主，这也目前Oracle默认的表空间设置。</p><h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/sql/Enlarging%20a%20Database%20by%20Adding%20a%20New%20Tablespace.gif"><br>以表空间所属用户身份登录</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 表空间名 tb_name</span><span class="token keyword">create</span> <span class="token keyword">tablespace</span> tb_name  <span class="token comment">-- 开启log</span>logging  <span class="token comment">-- 指定数据文件存放路径及文件名</span>datafile <span class="token string">'D:/app/Administrator/oradata/user_data.dbf'</span><span class="token comment">-- 初始大小</span>size <span class="token number">50</span>m  <span class="token comment">-- 自动拓展 开</span>autoextend <span class="token keyword">on</span>  <span class="token comment">-- 每次自动拓展大小</span><span class="token keyword">next</span> <span class="token number">50</span>m maxsize unlimitedextent management <span class="token keyword">local</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><p>查询已有表空间</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>tablespace_name                        <span class="token string">"表空间名"</span><span class="token punctuation">,</span>       total                                    <span class="token string">"表空间大小"</span><span class="token punctuation">,</span>       free                                     <span class="token string">"表空间剩余大小"</span><span class="token punctuation">,</span>       <span class="token punctuation">(</span> total <span class="token operator">-</span> free <span class="token punctuation">)</span>                         <span class="token string">"表空间使用大小"</span><span class="token punctuation">,</span>       <span class="token function">Round</span><span class="token punctuation">(</span><span class="token punctuation">(</span> total <span class="token operator">-</span> free <span class="token punctuation">)</span> <span class="token operator">/</span> total<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token string">"使用率   %"</span><span class="token keyword">FROM</span>   <span class="token punctuation">(</span><span class="token keyword">SELECT</span> tablespace_name<span class="token punctuation">,</span>               <span class="token function">Sum</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> free        <span class="token keyword">FROM</span>   DBA_FREE_SPACE        <span class="token keyword">GROUP</span>  <span class="token keyword">BY</span> tablespace_name<span class="token punctuation">)</span> a<span class="token punctuation">,</span>       <span class="token punctuation">(</span><span class="token keyword">SELECT</span> tablespace_name<span class="token punctuation">,</span>               <span class="token function">Sum</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> total        <span class="token keyword">FROM</span>   DBA_DATA_FILES        <span class="token keyword">GROUP</span>  <span class="token keyword">BY</span> tablespace_name<span class="token punctuation">)</span> b<span class="token keyword">WHERE</span>  a<span class="token punctuation">.</span>tablespace_name <span class="token operator">=</span> b<span class="token punctuation">.</span>tablespace_name<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>根据官方文档说明，扩展表空间有两种方式</p><blockquote><ul><li>Add a datafile to a tablespace</li><li>Increase the size of a datafile</li></ul></blockquote><p>第一种用于扩展系统表空间或其他已经存在的表空间<br>第二种用于直接拓展<strong>datafile</strong>大小，如果创建时设置了自动拓展就无需设置了</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/sql/Enlarging%20a%20Database%20by%20Adding%20a%20Datafile%20to%20a%20Tablespace.gif"></div><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/sql/Enlarging%20a%20Database%20by%20Dynamically%20Sizing%20Datafiles.gif"></div></div></div><p>第一种实现如下</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLESPACE</span> tb_name <span class="token comment">-- 不要跟已有文件冲突</span><span class="token keyword">ADD</span> DATAFILE <span class="token string">'D:/app/Administrator/oradata/user_data_1.dbf'</span><span class="token comment">-- 初始大小</span>size <span class="token number">50</span>m <span class="token comment">-- 自动拓展 开</span>autoextend <span class="token keyword">on</span> <span class="token comment">-- 每次自动拓展大小 可以设置大一些</span><span class="token keyword">next</span> <span class="token number">1024</span>m maxsize unlimited<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h2 id="收缩"><a href="#收缩" class="headerlink" title="收缩"></a>收缩</h2><p>删除表或者删除较多内容后，<strong>datafile</strong>文件不会自动缩减，可以通过<code>resize</code>方式重置表空间大小。用下面代码可以生成不同<strong>datafile</strong>的<code>resize</code>方案，再分别执行。</p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token comment">/*+ ordered use_hash(a,c) */</span>       <span class="token string">'alter database datafile '''</span>    <span class="token operator">||</span> a<span class="token punctuation">.</span>file_name    <span class="token operator">||</span> <span class="token string">''' resize '</span>    <span class="token operator">||</span> <span class="token function">round</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>filesize <span class="token operator">-</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>filesize <span class="token operator">-</span> c<span class="token punctuation">.</span>hwmsize <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">)</span>    <span class="token operator">||</span> <span class="token string">'M;'</span><span class="token punctuation">,</span>    a<span class="token punctuation">.</span>filesize<span class="token punctuation">,</span>    c<span class="token punctuation">.</span>hwmsize<span class="token keyword">FROM</span>    <span class="token punctuation">(</span>        <span class="token keyword">SELECT</span>            file_id<span class="token punctuation">,</span>            file_name<span class="token punctuation">,</span>            <span class="token function">round</span><span class="token punctuation">(</span>bytes <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span> filesize        <span class="token keyword">FROM</span>            dba_data_files    <span class="token punctuation">)</span>  a<span class="token punctuation">,</span>    <span class="token punctuation">(</span>        <span class="token keyword">SELECT</span>            file_id<span class="token punctuation">,</span>            <span class="token function">round</span><span class="token punctuation">(</span><span class="token function">MAX</span><span class="token punctuation">(</span>block_id<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span> hwmsize        <span class="token keyword">FROM</span>            dba_extents        <span class="token keyword">GROUP</span> <span class="token keyword">BY</span>            file_id    <span class="token punctuation">)</span>  c<span class="token keyword">WHERE</span>        a<span class="token punctuation">.</span>file_id <span class="token operator">=</span> c<span class="token punctuation">.</span>file_id    <span class="token operator">AND</span> a<span class="token punctuation">.</span>filesize <span class="token operator">-</span> c<span class="token punctuation">.</span>hwmsize <span class="token operator">></span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p>对于<strong>TEMP</strong>表空间，可以采用<code>shrink</code>方式<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="ALTER TABLE … SHRINK SPACE Command : Online Segment Shrink for Tables, LOBs and IOTs">[3]</span></a></sup>，与之相关还有<code>move</code>操作，可阅读相关文章<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="Oracle move和shrink释放高水位空间">[4]</span></a></sup></p><div class="code-wrapper"><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询temp表空间情况</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_temp_free_space<span class="token punctuation">;</span><span class="token comment">-- 收缩</span>  <span class="token keyword">alter</span> <span class="token keyword">tablespace</span> <span class="token keyword">temp</span> shrink space<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14220/physical.htm">Tablespaces, Datafiles, and Control Files</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://www.modb.pro/db/7369">BigFile和SmallFile表空间技术</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://oracle-base.com/articles/misc/alter-table-shrink-space-online">ALTER TABLE … SHRINK SPACE Command : Online Segment Shrink for Tables, LOBs and IOTs</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> ↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://blog.51cto.com/fengfeng688/1955137">Oracle move和shrink释放高水位空间</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
      <tag>Tablespace</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ArcGIS 要素映射关系建立</title>
    <link href="/2016/03/03/ArcGIS-%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84/"/>
    <url>/2016/03/03/ArcGIS-%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84/</url>
    
    <content type="html"><![CDATA[<p>要素映射关系是工作中常遇到的问题，举个例子，比如一个面要素图层和一个点要素图层，要想知道每个点是落在哪个面之中，就需要建立一个点和面的映射关系。</p><span id="more"></span><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>现有北京<a href="https://mattzou.com/2016/02/28/ArcGIS-Fishnet/#">网格图层</a>以及北京<strong>环线图层</strong>，要确定网格中每个格点处于几环。</p><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>选用<code> Join Data</code>工具，** Join data from another layer on spatial location **方法将两个图层的要素进行映射。 </p><h3 id="工具位置"><a href="#工具位置" class="headerlink" title="工具位置"></a>工具位置</h3><p>右键单击图层，选择<code>Join and Relates</code>，菜单中选<code>Join</code>。</p><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ArcGIS/%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB.1.jpg/pic" alt="映射关系 1"> </p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><blockquote><p>在目标图层也就是<strong>网格图层</strong>上单击右键，找到<code> Join</code>工具；</p></blockquote><ol><li>选择** Join **类型，第一种是只连接两个图层属性表，第二种是根据空间位置将图层要素进行连接，同时连接属性表；</li><li>选择连接对象，这里选择环线图层；</li><li>选择连接<code> Options</code>，第二种方式可以实现我们所需要的映射关系，即落入相应环线要素的网格都将被赋予<strong>环线图层</strong>的属性，如果给<strong>环线图层</strong>的每个要素都进行标记，比如一环为<code> ID</code>字段为* 1 <em>，那么在连接后，落在一环内的网格将会增加一个字段<code> ID</code> ，值为</em> 1 *；</li><li>导出文件。</li></ol><blockquote><p>参数选择如下：</p></blockquote><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ArcGIS/%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB.2.jpg/pic" alt="映射关系 2"></p><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><blockquote><p>生成的新图层如下所示：</p></blockquote><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ArcGIS/%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB.3.JPG/pic" alt="映射关系 3"></p><p>打开图层属性表，可以看到新增的字段，标识网格所处的环线，通过<code>selec by attributes</code>高亮所有有映射关系的网格，和环线图层匹配正确，目的达到。</p><hr>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ArcGIS</tag>
      
      <tag>映射关系</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ArcGIS 创建网格</title>
    <link href="/2016/02/28/ArcGIS-Fishnet/"/>
    <url>/2016/02/28/ArcGIS-Fishnet/</url>
    
    <content type="html"><![CDATA[<p>在排放展示和统计过程中，需要按照网格的方式进行划分，需要建立网格。</p><span id="more"></span><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul><li> 创建网格，覆盖现有图层要素</li><li> 可调整网格大小</li><li> 获取网格中心坐标</li></ul><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>在ArcGIS中，应用<strong>系统工具箱</strong>中的<code>Create Fishnet</code>工具来创建网格。</p><h3 id="工具位置"><a href="#工具位置" class="headerlink" title="工具位置"></a>工具位置</h3><p>在<strong>Catalog</strong>中选择<code>Toolboxes</code>，找到<code>System Toolboxes</code>，其中<code>Data Management Tools</code>工具箱中点开<code>Feature Class</code>一项就可以看见<code>Create Fishnet</code>工具。</p><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ArcGIS/create%20fishnet.1.jpg/pic" alt="create fishnet 1"></p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol><li>选择导出文件位置；</li><li><strong>可选项</strong>选择现有图层为模板，自动生成网格边界范围</li><li>修改自动生成范围数值；</li><li>手动输入网格边界范围，如果<em>2</em>步骤选择了模板图层，会自动生成边界数值；</li><li>设置网格宽度及高度<strong>数值单位与图层坐标系统匹配</strong>；</li><li>设置网格行数和列数<strong>如果选择了模板图层，最好都设置为0，会自动根据以上输入的网格尺寸及图层范围计算行列数，不用自己计算</strong>；</li><li><strong>可选项</strong>生成每个网格中心点图层，这个选项在之后定位网格位置时有用处；</li><li>选择网格类型，<code>POLYLINE</code>及<code>POLYGON</code>分别是生成线要素网格或生成面要素网格；</li></ol><blockquote><p>以天津市为模板图层，生成一个覆盖天津市的1Km*1Km的网格，参数选择如下图所示：</p></blockquote><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ArcGIS/create%20fishnet.2.jpg/pic" alt="create fishnet 2"></p><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><blockquote><p>设置好参数后生成的网格图层如下所示：</p></blockquote><p><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/ArcGIS/create%20fishnet.3.JPG/pic" alt="create fishnet 3"></p><p>以上就完成了网格图层的生成，接下来就可以用生成的网格对其他图层进行切分等操作了。</p><hr>]]></content>
    
    
    <categories>
      
      <category>软件使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ArcGIS</tag>
      
      <tag>Fishnet</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ArcGIS 常用功能应用汇总</title>
    <link href="/2016/02/27/ArcGIS%E5%AF%BC%E8%88%AA/"/>
    <url>/2016/02/27/ArcGIS%E5%AF%BC%E8%88%AA/</url>
    
    <content type="html"><![CDATA[<p>本篇用以记录平时使用ArcGIS时掌握的方法，这里汇总记录。</p><blockquote><p>当你第一次背起背包踏上远方的路,就永远都不会停下来!</p></blockquote><span id="more"></span><hr><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><blockquote><ol><li> <a href="http://mattzou.com/2016/02/28/ArcGIS-Fishnet/#">[创建网格]</a> <strong>ArcGIS</strong> <code>Create Fishnet</code> 应用</li><li> <a href="http://mattzou.com/2016/03/03/ArcGIS-%E8%A6%81%E7%B4%A0%E6%98%A0%E5%B0%84/#">[要素映射]</a> <strong>ArcGIS</strong> <code>Join</code> 应用</li><li> <a href="http://mattzou.com/2016/10/17/ArcGIS-%E8%B7%AF%E7%BD%91%E5%88%87%E5%88%86/#">[路网切分]</a> <strong>ArcGIS</strong> <code>Planarize Lines</code> 应用</li><li> <a href="https://mattzou.com/2019/07/07/ArcGIS-%E4%B8%8A%E4%B8%8B%E8%A7%92%E6%A0%87/#">[角标]</a> <strong>ArcGIS</strong> 专题图<code>Legend</code>设置</li></ol></blockquote>]]></content>
    
    
    <categories>
      
      <category>目录</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ArcGIS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cat</title>
    <link href="/1970/01/01/My-cat/"/>
    <url>/1970/01/01/My-cat/</url>
    
    <content type="html"><![CDATA[<p>人生中的三只猫（截至2021）</p><h2 id="笑笑"><a href="#笑笑" class="headerlink" title="笑笑"></a>笑笑</h2><p>喵星🌏</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/xx1.jpg"></div><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/xx4.jpg"></div><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/xx2.jpg"></div><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/xx5.jpg"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/xx3.jpg"></div></div></div><h2 id="小黑"><a href="#小黑" class="headerlink" title="小黑"></a>小黑</h2><p>高冷肥宅</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/xh1.jpg"></div><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/xh4.jpg"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/xh2.jpg"></div><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/xh3.jpg"></div></div></div><h2 id="福安"><a href="#福安" class="headerlink" title="福安"></a>福安</h2><p>怎么说呢🐱‍🏍</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/fa4.jpg"></div><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/fa2.jpg"></div><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/fa5.jpg"></div></div><div class="group-image-row"><div class="group-image-wrap"><img src="https://mattblog.oss-cn-beijing.aliyuncs.com/img/cat/fa3.jpg"></div></div></div>]]></content>
    
    
    
    <tags>
      
      <tag>猫</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
